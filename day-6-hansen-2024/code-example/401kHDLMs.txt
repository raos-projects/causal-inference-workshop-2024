----------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\chansen1\Documents\GitHub\NW2022_1Day\Stata Code\401kHDLMs.txt
  log type:  text
 opened on:  25 Jun 2024, 16:46:00

. 
. clear all

.  
. use "..\Data\sipp1991.dta", clear /* Load data. Assumes I am in my code subfolder */

. 
. *** Set seed for reproducibility
. set seed 71423

. 
. *** Split data into a training (~80%) and test (~20%) set
. gen trdata = runiform()

. replace trdata = trdata < .8
(9,915 real changes made)

. 
. * Sample sizes
. count if trdata
  7,854

. count if !trdata
  2,061

. 
. * Normalize inc,age,fsize,educ 
. replace age = age/64
variable age was byte now float
(9,915 real changes made)

. replace inc = inc/250000
(9,912 real changes made)

. replace fsize = fsize/13
variable fsize was byte now float
(9,915 real changes made)

. replace educ = educ/18
variable educ was byte now float
(9,915 real changes made)

. 
. * Create polynomials
. forvalues i = 2/6 {
  2.         gen age`i' = age^`i' 
  3. }

. 
. forvalues i = 2/8 {
  2.         gen inc`i' = inc^`i'
  3. }

. 
. forvalues i = 2/4 {
  2.         gen educ`i' = educ^`i'
  3. }

. 
. gen fsize2 = fsize^2

. 
. **********************************************************************
. *** Linear models in training data
. * Baseline
. qui reg net_tfa e401 age inc educ fsize marr twoearn db pira hown if trdata

. display "Base number of variables: " e(df_m)
Base number of variables: 10

. predict yhat_ols_base   
(option xb assumed; fitted values)

.         
. * Polynomial
. qui reg net_tfa e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 ///
>         inc6 inc7 inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown ///
>         if trdata

. display "Base number of variables: " e(df_m)
Base number of variables: 25

. predict yhat_ols_poly   
(option xb assumed; fitted values)

. 
. * Interacted
. qui reg net_tfa /// 
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown)## ///
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown) ///
>         if trdata

. display "Base number of variables: " e(df_m)
Base number of variables: 257

. predict yhat_ols_int    
(option xb assumed; fitted values)

.         
. ************************************************************************
. *** Spaghetti plots for ridge and lasso in polynomial model
. * Lasso
. lasso2 net_tfa e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 ///
>         inc6 inc7 inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown ///
>         if trdata, plotpath(lambda) plotopt(legend(off) ylabel(none)) ///
>         lambda(30010(250)10) lglmnet  /* lglmnet option makes lambda on same scale as glmnet */

  Knot|  ID     Lambda    s      L1-Norm        EBIC     R-sq   | Action
------+---------------------------------------------------------+---------------
     1|   1  3.001e+04     0     0.00000   1.7301e+05   0.0000  | Added _cons.
     2|   5  2.901e+04     1  7394.54993   1.7299e+05   0.0031  | Added inc3.
     3|  47  1.851e+04     2   3.999e+05   1.7185e+05   0.1388  | Added pira.
     4|  54  1.676e+04     3   4.586e+05   1.7161e+05   0.1658  | Added inc4.
     5|  83 9510.00000     4   8.563e+05   1.7073e+05   0.2545  | Added age3.
     6|  86 8760.00000     5   9.042e+05   1.7065e+05   0.2635  | Added inc2.
     7|  90 7760.00000     4   9.872e+05   1.7051e+05   0.2755  | Removed inc3.
     8|  95 6510.00000     5   1.057e+06   1.7039e+05   0.2870  | Added inc5.
     9|  99 5510.00000     6   1.154e+06   1.7030e+05   0.2959  | Added inc.
    10| 100 5260.00000     7   1.177e+06   1.7029e+05   0.2979  | Added age4.
    11| 104 4260.00000     8   1.270e+06   1.7022e+05   0.3052  | Added e401.
    12| 106 3760.00000     9   1.317e+06   1.7018e+05   0.3094  | Added twoearn.
    13| 110 2760.00000     9   1.416e+06   1.7006e+05   0.3195  | Added hown. Removed age3.
    14| 113 2010.00000     9   1.490e+06   1.7000e+05   0.3253  | Added age5. Removed inc4.
    15| 118  760.00000    11   1.601e+06   1.6995e+05   0.3311  | Added educ4 db.
    16| 119  510.00000    12   1.626e+06   1.6995e+05   0.3318  | Added fsize2.
    17| 120  260.00000    14   1.654e+06   1.6996e+05   0.3323  | Added age6 marr.
    18| 121   10.00000    20   1.682e+07   1.6996e+05   0.3366  | Added age2 age3 inc3 inc4 inc6 inc8
      |                                                         | educ educ2 fsize. Removed age4 age5
      |                                                         | inc5.
Use long option for full output.
Type e.g. lasso2, lic(ebic) to run the model selected by EBIC.

. graph export ..\Slides\figures\Stata_lassoSpaghetti.png , replace
file ..\Slides\figures\Stata_lassoSpaghetti.png saved as PNG format

. graph close

.         
. * Ridge 
. lasso2 net_tfa e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 ///
>         inc6 inc7 inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown ///
>         if trdata, plotpath(lambda) plotopt(legend(off) ylabel(none)) alpha(0) ///
>         lambda(1001000(10000)1000) 

  Knot|  ID     Lambda    s      L1-Norm        EBIC     R-sq   | Action
------+---------------------------------------------------------+---------------
     1|   1  1.001e+06    26   1.807e+05   1.7258e+05   0.0531  | All selected.
Use long option for full output.
Type e.g. lasso2, lic(ebic) to run the model selected by EBIC.

. graph export ..\Slides\figures\Stata_ridgeSpaghetti.png , replace
file ..\Slides\figures\Stata_ridgeSpaghetti.png saved as PNG format

. graph close

. 
. ****************************************************************************
. *** Cross-validation for Lasso and Ridge
. * Use 5-fold CV here
. 
. *** Baseline model
. * Lasso
. * Seed option controls the randomized split into folds (replicable).
. * Last option saves the fold variable as fvar for use all the way along
. cvlasso net_tfa e401 age inc educ fsize marr twoearn db pira hown if trdata, ///
>         lglmnet nfolds(5) seed(718) savefoldvar(fvar)   
Fold variable saved in fvar.

K-fold cross-validation with 5 folds. Elastic net with alpha=1.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      24339.432      3.478e+09      6.640e+08  
         2|      22177.184      3.391e+09      6.562e+08  
         3|      20207.024      3.313e+09      6.482e+08  ^
         4|      18411.888      3.248e+09      6.410e+08  
         5|      16776.226      3.195e+09      6.345e+08  
         6|      15285.873      3.150e+09      6.287e+08  
         7|      13927.918      3.113e+09      6.234e+08  
         8|        12690.6      3.082e+09      6.188e+08  
         9|      11563.202      3.051e+09      6.153e+08  
        10|      10535.959      3.022e+09      6.113e+08  
        11|      9599.9736      2.997e+09      6.071e+08  
        12|      8747.1384      2.976e+09      6.034e+08  
        13|      7970.0667      2.959e+09      6.000e+08  
        14|       7262.028      2.942e+09      5.984e+08  
        15|      6616.8894      2.926e+09      5.964e+08  
        16|      6029.0632      2.906e+09      5.920e+08  
        17|      5493.4578      2.889e+09      5.878e+08  
        18|      5005.4342      2.875e+09      5.839e+08  
        19|      4560.7652      2.863e+09      5.805e+08  
        20|      4155.5994      2.854e+09      5.773e+08  
        21|      3786.4274      2.846e+09      5.744e+08  
        22|      3450.0516      2.839e+09      5.718e+08  
        23|      3143.5585      2.834e+09      5.695e+08  
        24|      2864.2935      2.829e+09      5.673e+08  
        25|      2609.8375      2.826e+09      5.654e+08  
        26|      2377.9868      2.823e+09      5.636e+08  
        27|       2166.733      2.820e+09      5.620e+08  
        28|      1974.2464      2.818e+09      5.605e+08  
        29|      1798.8598      2.816e+09      5.592e+08  
        30|       1639.054      2.815e+09      5.580e+08  
        31|       1493.445      2.813e+09      5.570e+08  
        32|      1360.7715      2.812e+09      5.560e+08  
        33|      1239.8843      2.810e+09      5.551e+08  
        34|      1129.7364      2.809e+09      5.541e+08  
        35|      1029.3737      2.808e+09      5.533e+08  
        36|      937.92698      2.807e+09      5.525e+08  
        37|      854.60413      2.806e+09      5.518e+08  
        38|      778.68346      2.806e+09      5.511e+08  
        39|      709.50736      2.805e+09      5.504e+08  
        40|      646.47668      2.805e+09      5.498e+08  
        41|      589.04548      2.804e+09      5.492e+08  
        42|       536.7163      2.804e+09      5.487e+08  
        43|       489.0359      2.804e+09      5.482e+08  
        44|       445.5913      2.803e+09      5.477e+08  
        45|       406.0062      2.803e+09      5.473e+08  
        46|      369.93773      2.803e+09      5.470e+08  
        47|      337.07348      2.803e+09      5.467e+08  
        48|       307.1288      2.803e+09      5.464e+08  
        49|      279.84432      2.803e+09      5.461e+08  
        50|      254.98373      2.803e+09      5.459e+08  
        51|      232.33167      2.802e+09      5.457e+08  
        52|      211.69197      2.802e+09      5.455e+08  
        53|      192.88584      2.802e+09      5.453e+08  
        54|      175.75039      2.802e+09      5.452e+08  
        55|      160.13721      2.802e+09      5.450e+08  
        56|      145.91106      2.802e+09      5.449e+08  
        57|      132.94873      2.802e+09      5.448e+08  
        58|      121.13793      2.802e+09      5.447e+08  
        59|      110.37637      2.802e+09      5.446e+08  
        60|      100.57084      2.802e+09      5.445e+08  *
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse
Warning: lopt is at the limit of the lambda range.

. * When you run this - you get that the optimal lambda is at the end of the range.
. * Try again with a longer lambda sequence
. cvlasso net_tfa e401 age inc educ fsize marr twoearn db pira hown if trdata, ///
>         lglmnet foldvar(fvar) lambda(24010(50)10) 
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=1.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|          24010      3.466e+09      6.630e+08  
         2|          23960      3.464e+09      6.629e+08  
         3|          23910      3.462e+09      6.627e+08  
         4|          23860      3.461e+09      6.626e+08  
         5|          23810      3.459e+09      6.624e+08  
         6|          23760      3.457e+09      6.623e+08  
         7|          23710      3.455e+09      6.621e+08  
         8|          23660      3.453e+09      6.619e+08  
         9|          23610      3.451e+09      6.618e+08  
        10|          23560      3.449e+09      6.617e+08  
        11|          23510      3.447e+09      6.616e+08  
        12|          23460      3.445e+09      6.614e+08  
        13|          23410      3.443e+09      6.613e+08  
        14|          23360      3.441e+09      6.611e+08  
        15|          23310      3.439e+09      6.609e+08  
        16|          23260      3.437e+09      6.607e+08  
        17|          23210      3.435e+09      6.605e+08  
        18|          23160      3.432e+09      6.603e+08  
        19|          23110      3.430e+09      6.601e+08  
        20|          23060      3.428e+09      6.599e+08  
        21|          23010      3.426e+09      6.597e+08  
        22|          22960      3.424e+09      6.595e+08  
        23|          22910      3.422e+09      6.593e+08  
        24|          22860      3.420e+09      6.591e+08  
        25|          22810      3.417e+09      6.588e+08  
        26|          22760      3.415e+09      6.586e+08  
        27|          22710      3.413e+09      6.584e+08  
        28|          22660      3.411e+09      6.582e+08  
        29|          22610      3.409e+09      6.580e+08  
        30|          22560      3.407e+09      6.578e+08  
        31|          22510      3.405e+09      6.576e+08  
        32|          22460      3.403e+09      6.574e+08  
        33|          22410      3.401e+09      6.572e+08  
        34|          22360      3.398e+09      6.570e+08  
        35|          22310      3.396e+09      6.568e+08  
        36|          22260      3.394e+09      6.566e+08  
        37|          22210      3.392e+09      6.564e+08  
        38|          22160      3.390e+09      6.562e+08  
        39|          22110      3.388e+09      6.560e+08  
        40|          22060      3.386e+09      6.558e+08  
        41|          22010      3.384e+09      6.556e+08  
        42|          21960      3.382e+09      6.554e+08  
        43|          21910      3.380e+09      6.552e+08  
        44|          21860      3.378e+09      6.549e+08  
        45|          21810      3.376e+09      6.547e+08  
        46|          21760      3.374e+09      6.545e+08  
        47|          21710      3.372e+09      6.543e+08  
        48|          21660      3.370e+09      6.541e+08  
        49|          21610      3.368e+09      6.539e+08  
        50|          21560      3.366e+09      6.537e+08  
        51|          21510      3.364e+09      6.535e+08  
        52|          21460      3.362e+09      6.533e+08  
        53|          21410      3.360e+09      6.531e+08  
        54|          21360      3.358e+09      6.529e+08  
        55|          21310      3.356e+09      6.527e+08  
        56|          21260      3.354e+09      6.525e+08  
        57|          21210      3.352e+09      6.523e+08  
        58|          21160      3.350e+09      6.521e+08  
        59|          21110      3.348e+09      6.519e+08  
        60|          21060      3.346e+09      6.517e+08  ^
        61|          21010      3.344e+09      6.515e+08  
        62|          20960      3.342e+09      6.513e+08  
        63|          20910      3.340e+09      6.511e+08  
        64|          20860      3.338e+09      6.509e+08  
        65|          20810      3.336e+09      6.507e+08  
        66|          20760      3.334e+09      6.505e+08  
        67|          20710      3.332e+09      6.503e+08  
        68|          20660      3.330e+09      6.501e+08  
        69|          20610      3.328e+09      6.499e+08  
        70|          20560      3.326e+09      6.497e+08  
        71|          20510      3.325e+09      6.495e+08  
        72|          20460      3.323e+09      6.492e+08  
        73|          20410      3.321e+09      6.490e+08  
        74|          20360      3.319e+09      6.488e+08  
        75|          20310      3.317e+09      6.486e+08  
        76|          20260      3.315e+09      6.484e+08  
        77|          20210      3.313e+09      6.482e+08  
        78|          20160      3.311e+09      6.480e+08  
        79|          20110      3.309e+09      6.478e+08  
        80|          20060      3.308e+09      6.476e+08  
        81|          20010      3.306e+09      6.474e+08  
        82|          19960      3.304e+09      6.472e+08  
        83|          19910      3.302e+09      6.470e+08  
        84|          19860      3.300e+09      6.468e+08  
        85|          19810      3.298e+09      6.466e+08  
        86|          19760      3.296e+09      6.464e+08  
        87|          19710      3.295e+09      6.462e+08  
        88|          19660      3.293e+09      6.460e+08  
        89|          19610      3.291e+09      6.458e+08  
        90|          19560      3.289e+09      6.456e+08  
        91|          19510      3.287e+09      6.454e+08  
        92|          19460      3.285e+09      6.452e+08  
        93|          19410      3.284e+09      6.450e+08  
        94|          19360      3.282e+09      6.448e+08  
        95|          19310      3.280e+09      6.446e+08  
        96|          19260      3.278e+09      6.444e+08  
        97|          19210      3.276e+09      6.442e+08  
        98|          19160      3.275e+09      6.440e+08  
        99|          19110      3.273e+09      6.438e+08  
       100|          19060      3.271e+09      6.436e+08  
       101|          19010      3.269e+09      6.434e+08  
       102|          18960      3.268e+09      6.432e+08  
       103|          18910      3.266e+09      6.430e+08  
       104|          18860      3.264e+09      6.428e+08  
       105|          18810      3.262e+09      6.426e+08  
       106|          18760      3.260e+09      6.424e+08  
       107|          18710      3.259e+09      6.422e+08  
       108|          18660      3.257e+09      6.420e+08  
       109|          18610      3.255e+09      6.418e+08  
       110|          18560      3.254e+09      6.416e+08  
       111|          18510      3.252e+09      6.414e+08  
       112|          18460      3.250e+09      6.412e+08  
       113|          18410      3.248e+09      6.410e+08  
       114|          18360      3.247e+09      6.408e+08  
       115|          18310      3.245e+09      6.406e+08  
       116|          18260      3.243e+09      6.404e+08  
       117|          18210      3.242e+09      6.402e+08  
       118|          18160      3.240e+09      6.400e+08  
       119|          18110      3.238e+09      6.398e+08  
       120|          18060      3.236e+09      6.396e+08  
       121|          18010      3.235e+09      6.394e+08  
       122|          17960      3.233e+09      6.392e+08  
       123|          17910      3.231e+09      6.390e+08  
       124|          17860      3.230e+09      6.388e+08  
       125|          17810      3.228e+09      6.386e+08  
       126|          17760      3.226e+09      6.384e+08  
       127|          17710      3.225e+09      6.382e+08  
       128|          17660      3.223e+09      6.380e+08  
       129|          17610      3.221e+09      6.378e+08  
       130|          17560      3.220e+09      6.376e+08  
       131|          17510      3.218e+09      6.374e+08  
       132|          17460      3.217e+09      6.372e+08  
       133|          17410      3.215e+09      6.370e+08  
       134|          17360      3.213e+09      6.368e+08  
       135|          17310      3.212e+09      6.366e+08  
       136|          17260      3.210e+09      6.364e+08  
       137|          17210      3.208e+09      6.362e+08  
       138|          17160      3.207e+09      6.360e+08  
       139|          17110      3.205e+09      6.358e+08  
       140|          17060      3.204e+09      6.356e+08  
       141|          17010      3.202e+09      6.354e+08  
       142|          16960      3.201e+09      6.352e+08  
       143|          16910      3.199e+09      6.350e+08  
       144|          16860      3.197e+09      6.349e+08  
       145|          16810      3.196e+09      6.347e+08  
       146|          16760      3.194e+09      6.345e+08  
       147|          16710      3.193e+09      6.343e+08  
       148|          16660      3.191e+09      6.341e+08  
       149|          16610      3.190e+09      6.339e+08  
       150|          16560      3.188e+09      6.337e+08  
       151|          16510      3.186e+09      6.335e+08  
       152|          16460      3.185e+09      6.333e+08  
       153|          16410      3.183e+09      6.331e+08  
       154|          16360      3.182e+09      6.329e+08  
       155|          16310      3.180e+09      6.327e+08  
       156|          16260      3.179e+09      6.325e+08  
       157|          16210      3.177e+09      6.323e+08  
       158|          16160      3.176e+09      6.321e+08  
       159|          16110      3.174e+09      6.319e+08  
       160|          16060      3.173e+09      6.317e+08  
       161|          16010      3.171e+09      6.315e+08  
       162|          15960      3.170e+09      6.313e+08  
       163|          15910      3.168e+09      6.311e+08  
       164|          15860      3.167e+09      6.309e+08  
       165|          15810      3.165e+09      6.307e+08  
       166|          15760      3.164e+09      6.305e+08  
       167|          15710      3.162e+09      6.303e+08  
       168|          15660      3.161e+09      6.301e+08  
       169|          15610      3.160e+09      6.299e+08  
       170|          15560      3.158e+09      6.297e+08  
       171|          15510      3.157e+09      6.296e+08  
       172|          15460      3.155e+09      6.294e+08  
       173|          15410      3.154e+09      6.292e+08  
       174|          15360      3.152e+09      6.290e+08  
       175|          15310      3.151e+09      6.288e+08  
       176|          15260      3.149e+09      6.286e+08  
       177|          15210      3.148e+09      6.284e+08  
       178|          15160      3.147e+09      6.282e+08  
       179|          15110      3.145e+09      6.280e+08  
       180|          15060      3.144e+09      6.278e+08  
       181|          15010      3.142e+09      6.276e+08  
       182|          14960      3.141e+09      6.274e+08  
       183|          14910      3.140e+09      6.272e+08  
       184|          14860      3.138e+09      6.270e+08  
       185|          14810      3.137e+09      6.268e+08  
       186|          14760      3.135e+09      6.266e+08  
       187|          14710      3.134e+09      6.264e+08  
       188|          14660      3.133e+09      6.262e+08  
       189|          14610      3.131e+09      6.260e+08  
       190|          14560      3.130e+09      6.259e+08  
       191|          14510      3.129e+09      6.257e+08  
       192|          14460      3.127e+09      6.255e+08  
       193|          14410      3.126e+09      6.253e+08  
       194|          14360      3.125e+09      6.251e+08  
       195|          14310      3.123e+09      6.249e+08  
       196|          14260      3.122e+09      6.247e+08  
       197|          14210      3.121e+09      6.245e+08  
       198|          14160      3.119e+09      6.243e+08  
       199|          14110      3.118e+09      6.241e+08  
       200|          14060      3.117e+09      6.239e+08  
       201|          14010      3.115e+09      6.237e+08  
       202|          13960      3.114e+09      6.235e+08  
       203|          13910      3.113e+09      6.233e+08  
       204|          13860      3.111e+09      6.231e+08  
       205|          13810      3.110e+09      6.229e+08  
       206|          13760      3.109e+09      6.228e+08  
       207|          13710      3.108e+09      6.226e+08  
       208|          13660      3.106e+09      6.224e+08  
       209|          13610      3.105e+09      6.222e+08  
       210|          13560      3.104e+09      6.220e+08  
       211|          13510      3.102e+09      6.218e+08  
       212|          13460      3.101e+09      6.216e+08  
       213|          13410      3.100e+09      6.214e+08  
       214|          13360      3.099e+09      6.212e+08  
       215|          13310      3.097e+09      6.210e+08  
       216|          13260      3.096e+09      6.208e+08  
       217|          13210      3.095e+09      6.206e+08  
       218|          13160      3.094e+09      6.204e+08  
       219|          13110      3.093e+09      6.203e+08  
       220|          13060      3.091e+09      6.201e+08  
       221|          13010      3.090e+09      6.199e+08  
       222|          12960      3.089e+09      6.197e+08  
       223|          12910      3.088e+09      6.195e+08  
       224|          12860      3.086e+09      6.193e+08  
       225|          12810      3.085e+09      6.191e+08  
       226|          12760      3.084e+09      6.189e+08  
       227|          12710      3.083e+09      6.188e+08  
       228|          12660      3.081e+09      6.187e+08  
       229|          12610      3.080e+09      6.185e+08  
       230|          12560      3.079e+09      6.184e+08  
       231|          12510      3.078e+09      6.183e+08  
       232|          12460      3.076e+09      6.181e+08  
       233|          12410      3.075e+09      6.180e+08  
       234|          12360      3.074e+09      6.178e+08  
       235|          12310      3.072e+09      6.176e+08  
       236|          12260      3.071e+09      6.174e+08  
       237|          12210      3.070e+09      6.173e+08  
       238|          12160      3.068e+09      6.171e+08  
       239|          12110      3.067e+09      6.169e+08  
       240|          12060      3.065e+09      6.168e+08  
       241|          12010      3.064e+09      6.166e+08  
       242|          11960      3.062e+09      6.165e+08  
       243|          11910      3.061e+09      6.163e+08  
       244|          11860      3.059e+09      6.162e+08  
       245|          11810      3.058e+09      6.160e+08  
       246|          11760      3.057e+09      6.159e+08  
       247|          11710      3.055e+09      6.157e+08  
       248|          11660      3.054e+09      6.156e+08  
       249|          11610      3.052e+09      6.154e+08  
       250|          11560      3.051e+09      6.153e+08  
       251|          11510      3.050e+09      6.151e+08  
       252|          11460      3.048e+09      6.150e+08  
       253|          11410      3.047e+09      6.148e+08  
       254|          11360      3.045e+09      6.147e+08  
       255|          11310      3.044e+09      6.145e+08  
       256|          11260      3.043e+09      6.144e+08  
       257|          11210      3.041e+09      6.142e+08  
       258|          11160      3.040e+09      6.140e+08  
       259|          11110      3.038e+09      6.138e+08  
       260|          11060      3.037e+09      6.136e+08  
       261|          11010      3.036e+09      6.133e+08  
       262|          10960      3.034e+09      6.131e+08  
       263|          10910      3.033e+09      6.129e+08  
       264|          10860      3.031e+09      6.127e+08  
       265|          10810      3.030e+09      6.125e+08  
       266|          10760      3.028e+09      6.122e+08  
       267|          10710      3.027e+09      6.120e+08  
       268|          10660      3.026e+09      6.118e+08  
       269|          10610      3.024e+09      6.116e+08  
       270|          10560      3.023e+09      6.114e+08  
       271|          10510      3.021e+09      6.111e+08  
       272|          10460      3.020e+09      6.109e+08  
       273|          10410      3.019e+09      6.107e+08  
       274|          10360      3.017e+09      6.105e+08  
       275|          10310      3.016e+09      6.103e+08  
       276|          10260      3.014e+09      6.100e+08  
       277|          10210      3.013e+09      6.098e+08  
       278|          10160      3.012e+09      6.096e+08  
       279|          10110      3.010e+09      6.094e+08  
       280|          10060      3.009e+09      6.092e+08  
       281|          10010      3.008e+09      6.089e+08  
       282|           9960      3.006e+09      6.087e+08  
       283|           9910      3.005e+09      6.085e+08  
       284|           9860      3.004e+09      6.083e+08  
       285|           9810      3.002e+09      6.081e+08  
       286|           9760      3.001e+09      6.078e+08  
       287|           9710      3.000e+09      6.076e+08  
       288|           9660      2.999e+09      6.074e+08  
       289|           9610      2.997e+09      6.072e+08  
       290|           9560      2.996e+09      6.070e+08  
       291|           9510      2.995e+09      6.067e+08  
       292|           9460      2.994e+09      6.065e+08  
       293|           9410      2.992e+09      6.063e+08  
       294|           9360      2.991e+09      6.061e+08  
       295|           9310      2.990e+09      6.059e+08  
       296|           9260      2.989e+09      6.056e+08  
       297|           9210      2.987e+09      6.054e+08  
       298|           9160      2.986e+09      6.052e+08  
       299|           9110      2.985e+09      6.050e+08  
       300|           9060      2.984e+09      6.048e+08  
       301|           9010      2.983e+09      6.046e+08  
       302|           8960      2.981e+09      6.043e+08  
       303|           8910      2.980e+09      6.041e+08  
       304|           8860      2.979e+09      6.039e+08  
       305|           8810      2.978e+09      6.037e+08  
       306|           8760      2.977e+09      6.035e+08  
       307|           8710      2.976e+09      6.032e+08  
       308|           8660      2.974e+09      6.030e+08  
       309|           8610      2.973e+09      6.028e+08  
       310|           8560      2.972e+09      6.026e+08  
       311|           8510      2.971e+09      6.024e+08  
       312|           8460      2.970e+09      6.022e+08  
       313|           8410      2.969e+09      6.019e+08  
       314|           8360      2.968e+09      6.017e+08  
       315|           8310      2.967e+09      6.015e+08  
       316|           8260      2.965e+09      6.013e+08  
       317|           8210      2.964e+09      6.011e+08  
       318|           8160      2.963e+09      6.008e+08  
       319|           8110      2.962e+09      6.006e+08  
       320|           8060      2.961e+09      6.004e+08  
       321|           8010      2.960e+09      6.002e+08  
       322|           7960      2.959e+09      6.000e+08  
       323|           7910      2.958e+09      5.998e+08  
       324|           7860      2.957e+09      5.997e+08  
       325|           7810      2.955e+09      5.995e+08  
       326|           7760      2.954e+09      5.993e+08  
       327|           7710      2.953e+09      5.992e+08  
       328|           7660      2.952e+09      5.990e+08  
       329|           7610      2.951e+09      5.989e+08  
       330|           7560      2.950e+09      5.988e+08  
       331|           7510      2.948e+09      5.987e+08  
       332|           7460      2.947e+09      5.987e+08  
       333|           7410      2.946e+09      5.986e+08  
       334|           7360      2.945e+09      5.985e+08  
       335|           7310      2.944e+09      5.984e+08  
       336|           7260      2.942e+09      5.983e+08  
       337|           7210      2.941e+09      5.983e+08  
       338|           7160      2.940e+09      5.982e+08  
       339|           7110      2.939e+09      5.981e+08  
       340|           7060      2.938e+09      5.980e+08  
       341|           7010      2.937e+09      5.979e+08  
       342|           6960      2.935e+09      5.978e+08  
       343|           6910      2.934e+09      5.977e+08  
       344|           6860      2.933e+09      5.976e+08  
       345|           6810      2.932e+09      5.974e+08  
       346|           6760      2.930e+09      5.972e+08  
       347|           6710      2.929e+09      5.969e+08  
       348|           6660      2.927e+09      5.967e+08  
       349|           6610      2.926e+09      5.964e+08  
       350|           6560      2.924e+09      5.961e+08  
       351|           6510      2.922e+09      5.957e+08  
       352|           6460      2.920e+09      5.953e+08  
       353|           6410      2.919e+09      5.949e+08  
       354|           6360      2.917e+09      5.945e+08  
       355|           6310      2.915e+09      5.942e+08  
       356|           6260      2.913e+09      5.938e+08  
       357|           6210      2.912e+09      5.934e+08  
       358|           6160      2.910e+09      5.930e+08  
       359|           6110      2.908e+09      5.926e+08  
       360|           6060      2.907e+09      5.922e+08  
       361|           6010      2.905e+09      5.918e+08  
       362|           5960      2.903e+09      5.914e+08  
       363|           5910      2.902e+09      5.910e+08  
       364|           5860      2.900e+09      5.906e+08  
       365|           5810      2.899e+09      5.902e+08  
       366|           5760      2.897e+09      5.898e+08  
       367|           5710      2.895e+09      5.895e+08  
       368|           5660      2.894e+09      5.891e+08  
       369|           5610      2.892e+09      5.887e+08  
       370|           5560      2.891e+09      5.883e+08  
       371|           5510      2.889e+09      5.879e+08  
       372|           5460      2.888e+09      5.875e+08  
       373|           5410      2.886e+09      5.871e+08  
       374|           5360      2.885e+09      5.867e+08  
       375|           5310      2.883e+09      5.863e+08  
       376|           5260      2.882e+09      5.859e+08  
       377|           5210      2.881e+09      5.855e+08  
       378|           5160      2.879e+09      5.851e+08  
       379|           5110      2.878e+09      5.848e+08  
       380|           5060      2.876e+09      5.844e+08  
       381|           5010      2.875e+09      5.840e+08  
       382|           4960      2.874e+09      5.836e+08  
       383|           4910      2.872e+09      5.832e+08  
       384|           4860      2.871e+09      5.828e+08  
       385|           4810      2.870e+09      5.824e+08  
       386|           4760      2.868e+09      5.820e+08  
       387|           4710      2.867e+09      5.816e+08  
       388|           4660      2.866e+09      5.812e+08  
       389|           4610      2.864e+09      5.809e+08  
       390|           4560      2.863e+09      5.805e+08  
       391|           4510      2.862e+09      5.801e+08  
       392|           4460      2.861e+09      5.797e+08  
       393|           4410      2.860e+09      5.793e+08  
       394|           4360      2.858e+09      5.789e+08  
       395|           4310      2.857e+09      5.785e+08  
       396|           4260      2.856e+09      5.781e+08  
       397|           4210      2.855e+09      5.777e+08  
       398|           4160      2.854e+09      5.773e+08  
       399|           4110      2.853e+09      5.770e+08  
       400|           4060      2.851e+09      5.766e+08  
       401|           4010      2.850e+09      5.762e+08  
       402|           3960      2.849e+09      5.758e+08  
       403|           3910      2.848e+09      5.754e+08  
       404|           3860      2.847e+09      5.750e+08  
       405|           3810      2.846e+09      5.746e+08  
       406|           3760      2.845e+09      5.742e+08  
       407|           3710      2.844e+09      5.738e+08  
       408|           3660      2.843e+09      5.735e+08  
       409|           3610      2.842e+09      5.731e+08  
       410|           3560      2.841e+09      5.727e+08  
       411|           3510      2.840e+09      5.723e+08  
       412|           3460      2.839e+09      5.719e+08  
       413|           3410      2.838e+09      5.715e+08  
       414|           3360      2.837e+09      5.711e+08  
       415|           3310      2.837e+09      5.708e+08  
       416|           3260      2.836e+09      5.704e+08  
       417|           3210      2.835e+09      5.700e+08  
       418|           3160      2.834e+09      5.696e+08  
       419|           3110      2.833e+09      5.692e+08  
       420|           3060      2.832e+09      5.688e+08  
       421|           3010      2.832e+09      5.684e+08  
       422|           2960      2.831e+09      5.681e+08  
       423|           2910      2.830e+09      5.677e+08  
       424|           2860      2.829e+09      5.673e+08  
       425|           2810      2.828e+09      5.669e+08  
       426|           2760      2.828e+09      5.665e+08  
       427|           2710      2.827e+09      5.661e+08  
       428|           2660      2.826e+09      5.657e+08  
       429|           2610      2.826e+09      5.654e+08  
       430|           2560      2.825e+09      5.650e+08  
       431|           2510      2.824e+09      5.646e+08  
       432|           2460      2.824e+09      5.642e+08  
       433|           2410      2.823e+09      5.638e+08  
       434|           2360      2.822e+09      5.634e+08  
       435|           2310      2.822e+09      5.631e+08  
       436|           2260      2.821e+09      5.627e+08  
       437|           2210      2.821e+09      5.623e+08  
       438|           2160      2.820e+09      5.619e+08  
       439|           2110      2.820e+09      5.615e+08  
       440|           2060      2.819e+09      5.612e+08  
       441|           2010      2.819e+09      5.608e+08  
       442|           1960      2.818e+09      5.604e+08  
       443|           1910      2.818e+09      5.600e+08  
       444|           1860      2.817e+09      5.597e+08  
       445|           1810      2.817e+09      5.593e+08  
       446|           1760      2.816e+09      5.589e+08  
       447|           1710      2.816e+09      5.585e+08  
       448|           1660      2.815e+09      5.581e+08  
       449|           1610      2.814e+09      5.578e+08  
       450|           1560      2.814e+09      5.574e+08  
       451|           1510      2.814e+09      5.571e+08  
       452|           1460      2.813e+09      5.567e+08  
       453|           1410      2.812e+09      5.564e+08  
       454|           1360      2.812e+09      5.560e+08  
       455|           1310      2.811e+09      5.556e+08  
       456|           1260      2.811e+09      5.552e+08  
       457|           1210      2.810e+09      5.548e+08  
       458|           1160      2.810e+09      5.544e+08  
       459|           1110      2.809e+09      5.540e+08  
       460|           1060      2.808e+09      5.535e+08  
       461|           1010      2.808e+09      5.531e+08  
       462|            960      2.807e+09      5.527e+08  
       463|            910      2.807e+09      5.522e+08  
       464|            860      2.806e+09      5.518e+08  
       465|            810      2.806e+09      5.514e+08  
       466|            760      2.806e+09      5.509e+08  
       467|            710      2.805e+09      5.504e+08  
       468|            660      2.805e+09      5.499e+08  
       469|            610      2.804e+09      5.494e+08  
       470|            560      2.804e+09      5.489e+08  
       471|            510      2.804e+09      5.484e+08  
       472|            460      2.803e+09      5.479e+08  
       473|            410      2.803e+09      5.474e+08  
       474|            360      2.803e+09      5.469e+08  
       475|            310      2.803e+09      5.464e+08  
       476|            260      2.803e+09      5.459e+08  
       477|            210      2.802e+09      5.455e+08  
       478|            160      2.802e+09      5.450e+08  
       479|            110      2.802e+09      5.446e+08  
       480|             60      2.802e+09      5.441e+08  *
       481|             10      2.802e+09      5.437e+08  
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse

.         /* Reusing the folds from the first run */
. 
. local lbaseRMSE = sqrt(e(mspemin))

. display "Baseline - Lasso CV " `lbaseRMSE'
Baseline - Lasso CV 52937.117

.         
. cvlasso, plotcv /* Cross validation plot */

. graph export ..\Slides\figures\Stata_LassoBasicCV.png , replace
file ..\Slides\figures\Stata_LassoBasicCV.png saved as PNG format

. graph close

.         
. * Store the model.
. est store cv_lasso_base

. * get the predictions (in-sample and out-of-sample)
. predict yhat_lasso_base, lopt
Estimate lasso with lambda=60 (lopt).

---------------------------------------------------
         Selected |           Lasso   Post-est OLS
------------------+--------------------------------
             e401 |    4156.3582504   4297.9028403
              age |   40421.8072598  40437.1907718
              inc |  235139.3060230 236003.1700406
             educ |  -12886.4194653 -13548.4820715
            fsize |  -12875.7702566 -14114.9567227
             marr |     423.4951384    802.4907393
          twoearn |  -19362.5903629 -19730.5610996
               db |   -3766.7683866  -3892.5016191
             pira |   27900.0985788  27959.4329523
             hown |    1302.2045759   1374.1731132
------------------+--------------------------------
   Partialled-out*|
------------------+--------------------------------
            _cons |  -31909.5171315 -31458.0592598
---------------------------------------------------
No xb or residuals options specified. Assume xb (fitted values).
Use e(b) from previous lasso2 estimation (lambda=60).

. 
. * Ridge - use same folds
. cvlasso net_tfa e401 age inc educ fsize marr twoearn db pira hown if trdata, ///
>         foldvar(fvar) alpha(0) lambda(24010(50)10) plotcv
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=0.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|          24010      3.053e+09      6.220e+08  ^
         2|          23960      3.052e+09      6.219e+08  
         3|          23910      3.052e+09      6.219e+08  
         4|          23860      3.052e+09      6.218e+08  
         5|          23810      3.051e+09      6.217e+08  
         6|          23760      3.051e+09      6.217e+08  
         7|          23710      3.050e+09      6.216e+08  
         8|          23660      3.050e+09      6.216e+08  
         9|          23610      3.049e+09      6.215e+08  
        10|          23560      3.049e+09      6.215e+08  
        11|          23510      3.049e+09      6.214e+08  
        12|          23460      3.048e+09      6.214e+08  
        13|          23410      3.048e+09      6.213e+08  
        14|          23360      3.047e+09      6.212e+08  
        15|          23310      3.047e+09      6.212e+08  
        16|          23260      3.046e+09      6.211e+08  
        17|          23210      3.046e+09      6.211e+08  
        18|          23160      3.046e+09      6.210e+08  
        19|          23110      3.045e+09      6.210e+08  
        20|          23060      3.045e+09      6.209e+08  
        21|          23010      3.044e+09      6.208e+08  
        22|          22960      3.044e+09      6.208e+08  
        23|          22910      3.043e+09      6.207e+08  
        24|          22860      3.043e+09      6.207e+08  
        25|          22810      3.043e+09      6.206e+08  
        26|          22760      3.042e+09      6.206e+08  
        27|          22710      3.042e+09      6.205e+08  
        28|          22660      3.041e+09      6.204e+08  
        29|          22610      3.041e+09      6.204e+08  
        30|          22560      3.040e+09      6.203e+08  
        31|          22510      3.040e+09      6.203e+08  
        32|          22460      3.040e+09      6.202e+08  
        33|          22410      3.039e+09      6.201e+08  
        34|          22360      3.039e+09      6.201e+08  
        35|          22310      3.038e+09      6.200e+08  
        36|          22260      3.038e+09      6.200e+08  
        37|          22210      3.037e+09      6.199e+08  
        38|          22160      3.037e+09      6.199e+08  
        39|          22110      3.036e+09      6.198e+08  
        40|          22060      3.036e+09      6.197e+08  
        41|          22010      3.036e+09      6.197e+08  
        42|          21960      3.035e+09      6.196e+08  
        43|          21910      3.035e+09      6.195e+08  
        44|          21860      3.034e+09      6.195e+08  
        45|          21810      3.034e+09      6.194e+08  
        46|          21760      3.033e+09      6.194e+08  
        47|          21710      3.033e+09      6.193e+08  
        48|          21660      3.032e+09      6.192e+08  
        49|          21610      3.032e+09      6.192e+08  
        50|          21560      3.032e+09      6.191e+08  
        51|          21510      3.031e+09      6.191e+08  
        52|          21460      3.031e+09      6.190e+08  
        53|          21410      3.030e+09      6.189e+08  
        54|          21360      3.030e+09      6.189e+08  
        55|          21310      3.029e+09      6.188e+08  
        56|          21260      3.029e+09      6.187e+08  
        57|          21210      3.028e+09      6.187e+08  
        58|          21160      3.028e+09      6.186e+08  
        59|          21110      3.028e+09      6.186e+08  
        60|          21060      3.027e+09      6.185e+08  
        61|          21010      3.027e+09      6.184e+08  
        62|          20960      3.026e+09      6.184e+08  
        63|          20910      3.026e+09      6.183e+08  
        64|          20860      3.025e+09      6.182e+08  
        65|          20810      3.025e+09      6.182e+08  
        66|          20760      3.024e+09      6.181e+08  
        67|          20710      3.024e+09      6.180e+08  
        68|          20660      3.023e+09      6.180e+08  
        69|          20610      3.023e+09      6.179e+08  
        70|          20560      3.023e+09      6.178e+08  
        71|          20510      3.022e+09      6.178e+08  
        72|          20460      3.022e+09      6.177e+08  
        73|          20410      3.021e+09      6.176e+08  
        74|          20360      3.021e+09      6.176e+08  
        75|          20310      3.020e+09      6.175e+08  
        76|          20260      3.020e+09      6.174e+08  
        77|          20210      3.019e+09      6.174e+08  
        78|          20160      3.019e+09      6.173e+08  
        79|          20110      3.018e+09      6.172e+08  
        80|          20060      3.018e+09      6.172e+08  
        81|          20010      3.017e+09      6.171e+08  
        82|          19960      3.017e+09      6.170e+08  
        83|          19910      3.017e+09      6.170e+08  
        84|          19860      3.016e+09      6.169e+08  
        85|          19810      3.016e+09      6.168e+08  
        86|          19760      3.015e+09      6.168e+08  
        87|          19710      3.015e+09      6.167e+08  
        88|          19660      3.014e+09      6.166e+08  
        89|          19610      3.014e+09      6.166e+08  
        90|          19560      3.013e+09      6.165e+08  
        91|          19510      3.013e+09      6.164e+08  
        92|          19460      3.012e+09      6.164e+08  
        93|          19410      3.012e+09      6.163e+08  
        94|          19360      3.011e+09      6.162e+08  
        95|          19310      3.011e+09      6.161e+08  
        96|          19260      3.010e+09      6.161e+08  
        97|          19210      3.010e+09      6.160e+08  
        98|          19160      3.009e+09      6.159e+08  
        99|          19110      3.009e+09      6.159e+08  
       100|          19060      3.008e+09      6.158e+08  
       101|          19010      3.008e+09      6.157e+08  
       102|          18960      3.008e+09      6.156e+08  
       103|          18910      3.007e+09      6.156e+08  
       104|          18860      3.007e+09      6.155e+08  
       105|          18810      3.006e+09      6.154e+08  
       106|          18760      3.006e+09      6.154e+08  
       107|          18710      3.005e+09      6.153e+08  
       108|          18660      3.005e+09      6.152e+08  
       109|          18610      3.004e+09      6.151e+08  
       110|          18560      3.004e+09      6.151e+08  
       111|          18510      3.003e+09      6.150e+08  
       112|          18460      3.003e+09      6.149e+08  
       113|          18410      3.002e+09      6.148e+08  
       114|          18360      3.002e+09      6.148e+08  
       115|          18310      3.001e+09      6.147e+08  
       116|          18260      3.001e+09      6.146e+08  
       117|          18210      3.000e+09      6.145e+08  
       118|          18160      3.000e+09      6.145e+08  
       119|          18110      2.999e+09      6.144e+08  
       120|          18060      2.999e+09      6.143e+08  
       121|          18010      2.998e+09      6.142e+08  
       122|          17960      2.998e+09      6.142e+08  
       123|          17910      2.997e+09      6.141e+08  
       124|          17860      2.997e+09      6.140e+08  
       125|          17810      2.996e+09      6.139e+08  
       126|          17760      2.996e+09      6.139e+08  
       127|          17710      2.995e+09      6.138e+08  
       128|          17660      2.995e+09      6.137e+08  
       129|          17610      2.994e+09      6.136e+08  
       130|          17560      2.994e+09      6.135e+08  
       131|          17510      2.993e+09      6.135e+08  
       132|          17460      2.993e+09      6.134e+08  
       133|          17410      2.992e+09      6.133e+08  
       134|          17360      2.992e+09      6.132e+08  
       135|          17310      2.991e+09      6.132e+08  
       136|          17260      2.991e+09      6.131e+08  
       137|          17210      2.990e+09      6.130e+08  
       138|          17160      2.990e+09      6.129e+08  
       139|          17110      2.989e+09      6.128e+08  
       140|          17060      2.989e+09      6.128e+08  
       141|          17010      2.988e+09      6.127e+08  
       142|          16960      2.988e+09      6.126e+08  
       143|          16910      2.987e+09      6.125e+08  
       144|          16860      2.987e+09      6.124e+08  
       145|          16810      2.986e+09      6.123e+08  
       146|          16760      2.986e+09      6.123e+08  
       147|          16710      2.985e+09      6.122e+08  
       148|          16660      2.985e+09      6.121e+08  
       149|          16610      2.984e+09      6.120e+08  
       150|          16560      2.984e+09      6.119e+08  
       151|          16510      2.983e+09      6.118e+08  
       152|          16460      2.983e+09      6.118e+08  
       153|          16410      2.982e+09      6.117e+08  
       154|          16360      2.982e+09      6.116e+08  
       155|          16310      2.981e+09      6.115e+08  
       156|          16260      2.981e+09      6.114e+08  
       157|          16210      2.980e+09      6.113e+08  
       158|          16160      2.980e+09      6.113e+08  
       159|          16110      2.979e+09      6.112e+08  
       160|          16060      2.979e+09      6.111e+08  
       161|          16010      2.978e+09      6.110e+08  
       162|          15960      2.978e+09      6.109e+08  
       163|          15910      2.977e+09      6.108e+08  
       164|          15860      2.977e+09      6.107e+08  
       165|          15810      2.976e+09      6.107e+08  
       166|          15760      2.975e+09      6.106e+08  
       167|          15710      2.975e+09      6.105e+08  
       168|          15660      2.974e+09      6.104e+08  
       169|          15610      2.974e+09      6.103e+08  
       170|          15560      2.973e+09      6.102e+08  
       171|          15510      2.973e+09      6.101e+08  
       172|          15460      2.972e+09      6.100e+08  
       173|          15410      2.972e+09      6.099e+08  
       174|          15360      2.971e+09      6.099e+08  
       175|          15310      2.971e+09      6.098e+08  
       176|          15260      2.970e+09      6.097e+08  
       177|          15210      2.970e+09      6.096e+08  
       178|          15160      2.969e+09      6.095e+08  
       179|          15110      2.969e+09      6.094e+08  
       180|          15060      2.968e+09      6.093e+08  
       181|          15010      2.968e+09      6.092e+08  
       182|          14960      2.967e+09      6.091e+08  
       183|          14910      2.966e+09      6.090e+08  
       184|          14860      2.966e+09      6.089e+08  
       185|          14810      2.965e+09      6.088e+08  
       186|          14760      2.965e+09      6.087e+08  
       187|          14710      2.964e+09      6.086e+08  
       188|          14660      2.964e+09      6.086e+08  
       189|          14610      2.963e+09      6.085e+08  
       190|          14560      2.963e+09      6.084e+08  
       191|          14510      2.962e+09      6.083e+08  
       192|          14460      2.962e+09      6.082e+08  
       193|          14410      2.961e+09      6.081e+08  
       194|          14360      2.961e+09      6.080e+08  
       195|          14310      2.960e+09      6.079e+08  
       196|          14260      2.959e+09      6.078e+08  
       197|          14210      2.959e+09      6.077e+08  
       198|          14160      2.958e+09      6.076e+08  
       199|          14110      2.958e+09      6.075e+08  
       200|          14060      2.957e+09      6.074e+08  
       201|          14010      2.957e+09      6.073e+08  
       202|          13960      2.956e+09      6.072e+08  
       203|          13910      2.956e+09      6.071e+08  
       204|          13860      2.955e+09      6.070e+08  
       205|          13810      2.955e+09      6.069e+08  
       206|          13760      2.954e+09      6.068e+08  
       207|          13710      2.953e+09      6.067e+08  
       208|          13660      2.953e+09      6.066e+08  
       209|          13610      2.952e+09      6.065e+08  
       210|          13560      2.952e+09      6.064e+08  
       211|          13510      2.951e+09      6.063e+08  
       212|          13460      2.951e+09      6.062e+08  
       213|          13410      2.950e+09      6.061e+08  
       214|          13360      2.950e+09      6.060e+08  
       215|          13310      2.949e+09      6.059e+08  
       216|          13260      2.948e+09      6.058e+08  
       217|          13210      2.948e+09      6.057e+08  
       218|          13160      2.947e+09      6.055e+08  
       219|          13110      2.947e+09      6.054e+08  
       220|          13060      2.946e+09      6.053e+08  
       221|          13010      2.946e+09      6.052e+08  
       222|          12960      2.945e+09      6.051e+08  
       223|          12910      2.944e+09      6.050e+08  
       224|          12860      2.944e+09      6.049e+08  
       225|          12810      2.943e+09      6.048e+08  
       226|          12760      2.943e+09      6.047e+08  
       227|          12710      2.942e+09      6.046e+08  
       228|          12660      2.942e+09      6.045e+08  
       229|          12610      2.941e+09      6.044e+08  
       230|          12560      2.941e+09      6.042e+08  
       231|          12510      2.940e+09      6.041e+08  
       232|          12460      2.939e+09      6.040e+08  
       233|          12410      2.939e+09      6.039e+08  
       234|          12360      2.938e+09      6.038e+08  
       235|          12310      2.938e+09      6.037e+08  
       236|          12260      2.937e+09      6.036e+08  
       237|          12210      2.937e+09      6.035e+08  
       238|          12160      2.936e+09      6.033e+08  
       239|          12110      2.935e+09      6.032e+08  
       240|          12060      2.935e+09      6.031e+08  
       241|          12010      2.934e+09      6.030e+08  
       242|          11960      2.934e+09      6.029e+08  
       243|          11910      2.933e+09      6.028e+08  
       244|          11860      2.932e+09      6.027e+08  
       245|          11810      2.932e+09      6.025e+08  
       246|          11760      2.931e+09      6.024e+08  
       247|          11710      2.931e+09      6.023e+08  
       248|          11660      2.930e+09      6.022e+08  
       249|          11610      2.930e+09      6.021e+08  
       250|          11560      2.929e+09      6.019e+08  
       251|          11510      2.928e+09      6.018e+08  
       252|          11460      2.928e+09      6.017e+08  
       253|          11410      2.927e+09      6.016e+08  
       254|          11360      2.927e+09      6.015e+08  
       255|          11310      2.926e+09      6.013e+08  
       256|          11260      2.925e+09      6.012e+08  
       257|          11210      2.925e+09      6.011e+08  
       258|          11160      2.924e+09      6.010e+08  
       259|          11110      2.924e+09      6.008e+08  
       260|          11060      2.923e+09      6.007e+08  
       261|          11010      2.923e+09      6.006e+08  
       262|          10960      2.922e+09      6.005e+08  
       263|          10910      2.921e+09      6.003e+08  
       264|          10860      2.921e+09      6.002e+08  
       265|          10810      2.920e+09      6.001e+08  
       266|          10760      2.920e+09      6.000e+08  
       267|          10710      2.919e+09      5.998e+08  
       268|          10660      2.918e+09      5.997e+08  
       269|          10610      2.918e+09      5.996e+08  
       270|          10560      2.917e+09      5.994e+08  
       271|          10510      2.917e+09      5.993e+08  
       272|          10460      2.916e+09      5.992e+08  
       273|          10410      2.915e+09      5.990e+08  
       274|          10360      2.915e+09      5.989e+08  
       275|          10310      2.914e+09      5.988e+08  
       276|          10260      2.914e+09      5.986e+08  
       277|          10210      2.913e+09      5.985e+08  
       278|          10160      2.912e+09      5.984e+08  
       279|          10110      2.912e+09      5.982e+08  
       280|          10060      2.911e+09      5.981e+08  
       281|          10010      2.911e+09      5.980e+08  
       282|           9960      2.910e+09      5.978e+08  
       283|           9910      2.909e+09      5.977e+08  
       284|           9860      2.909e+09      5.975e+08  
       285|           9810      2.908e+09      5.974e+08  
       286|           9760      2.907e+09      5.973e+08  
       287|           9710      2.907e+09      5.971e+08  
       288|           9660      2.906e+09      5.970e+08  
       289|           9610      2.906e+09      5.968e+08  
       290|           9560      2.905e+09      5.967e+08  
       291|           9510      2.904e+09      5.966e+08  
       292|           9460      2.904e+09      5.964e+08  
       293|           9410      2.903e+09      5.963e+08  
       294|           9360      2.903e+09      5.961e+08  
       295|           9310      2.902e+09      5.960e+08  
       296|           9260      2.901e+09      5.958e+08  
       297|           9210      2.901e+09      5.957e+08  
       298|           9160      2.900e+09      5.955e+08  
       299|           9110      2.900e+09      5.954e+08  
       300|           9060      2.899e+09      5.952e+08  
       301|           9010      2.898e+09      5.951e+08  
       302|           8960      2.898e+09      5.949e+08  
       303|           8910      2.897e+09      5.948e+08  
       304|           8860      2.896e+09      5.946e+08  
       305|           8810      2.896e+09      5.945e+08  
       306|           8760      2.895e+09      5.943e+08  
       307|           8710      2.895e+09      5.942e+08  
       308|           8660      2.894e+09      5.940e+08  
       309|           8610      2.893e+09      5.938e+08  
       310|           8560      2.893e+09      5.937e+08  
       311|           8510      2.892e+09      5.935e+08  
       312|           8460      2.891e+09      5.934e+08  
       313|           8410      2.891e+09      5.932e+08  
       314|           8360      2.890e+09      5.931e+08  
       315|           8310      2.890e+09      5.929e+08  
       316|           8260      2.889e+09      5.927e+08  
       317|           8210      2.888e+09      5.926e+08  
       318|           8160      2.888e+09      5.924e+08  
       319|           8110      2.887e+09      5.922e+08  
       320|           8060      2.886e+09      5.921e+08  
       321|           8010      2.886e+09      5.919e+08  
       322|           7960      2.885e+09      5.917e+08  
       323|           7910      2.884e+09      5.916e+08  
       324|           7860      2.884e+09      5.914e+08  
       325|           7810      2.883e+09      5.912e+08  
       326|           7760      2.883e+09      5.911e+08  
       327|           7710      2.882e+09      5.909e+08  
       328|           7660      2.881e+09      5.907e+08  
       329|           7610      2.881e+09      5.905e+08  
       330|           7560      2.880e+09      5.904e+08  
       331|           7510      2.879e+09      5.902e+08  
       332|           7460      2.879e+09      5.900e+08  
       333|           7410      2.878e+09      5.898e+08  
       334|           7360      2.878e+09      5.897e+08  
       335|           7310      2.877e+09      5.895e+08  
       336|           7260      2.876e+09      5.893e+08  
       337|           7210      2.876e+09      5.891e+08  
       338|           7160      2.875e+09      5.889e+08  
       339|           7110      2.874e+09      5.888e+08  
       340|           7060      2.874e+09      5.886e+08  
       341|           7010      2.873e+09      5.884e+08  
       342|           6960      2.872e+09      5.882e+08  
       343|           6910      2.872e+09      5.880e+08  
       344|           6860      2.871e+09      5.878e+08  
       345|           6810      2.870e+09      5.876e+08  
       346|           6760      2.870e+09      5.874e+08  
       347|           6710      2.869e+09      5.873e+08  
       348|           6660      2.869e+09      5.871e+08  
       349|           6610      2.868e+09      5.869e+08  
       350|           6560      2.867e+09      5.867e+08  
       351|           6510      2.867e+09      5.865e+08  
       352|           6460      2.866e+09      5.863e+08  
       353|           6410      2.865e+09      5.861e+08  
       354|           6360      2.865e+09      5.859e+08  
       355|           6310      2.864e+09      5.857e+08  
       356|           6260      2.863e+09      5.855e+08  
       357|           6210      2.863e+09      5.853e+08  
       358|           6160      2.862e+09      5.851e+08  
       359|           6110      2.861e+09      5.849e+08  
       360|           6060      2.861e+09      5.847e+08  
       361|           6010      2.860e+09      5.845e+08  
       362|           5960      2.860e+09      5.842e+08  
       363|           5910      2.859e+09      5.840e+08  
       364|           5860      2.858e+09      5.838e+08  
       365|           5810      2.858e+09      5.836e+08  
       366|           5760      2.857e+09      5.834e+08  
       367|           5710      2.856e+09      5.832e+08  
       368|           5660      2.856e+09      5.830e+08  
       369|           5610      2.855e+09      5.827e+08  
       370|           5560      2.854e+09      5.825e+08  
       371|           5510      2.854e+09      5.823e+08  
       372|           5460      2.853e+09      5.821e+08  
       373|           5410      2.853e+09      5.819e+08  
       374|           5360      2.852e+09      5.816e+08  
       375|           5310      2.851e+09      5.814e+08  
       376|           5260      2.851e+09      5.812e+08  
       377|           5210      2.850e+09      5.810e+08  
       378|           5160      2.849e+09      5.807e+08  
       379|           5110      2.849e+09      5.805e+08  
       380|           5060      2.848e+09      5.803e+08  
       381|           5010      2.847e+09      5.800e+08  
       382|           4960      2.847e+09      5.798e+08  
       383|           4910      2.846e+09      5.795e+08  
       384|           4860      2.846e+09      5.793e+08  
       385|           4810      2.845e+09      5.791e+08  
       386|           4760      2.844e+09      5.788e+08  
       387|           4710      2.844e+09      5.786e+08  
       388|           4660      2.843e+09      5.783e+08  
       389|           4610      2.842e+09      5.781e+08  
       390|           4560      2.842e+09      5.778e+08  
       391|           4510      2.841e+09      5.776e+08  
       392|           4460      2.840e+09      5.773e+08  
       393|           4410      2.840e+09      5.771e+08  
       394|           4360      2.839e+09      5.768e+08  
       395|           4310      2.839e+09      5.766e+08  
       396|           4260      2.838e+09      5.763e+08  
       397|           4210      2.837e+09      5.760e+08  
       398|           4160      2.837e+09      5.758e+08  
       399|           4110      2.836e+09      5.755e+08  
       400|           4060      2.835e+09      5.752e+08  
       401|           4010      2.835e+09      5.750e+08  
       402|           3960      2.834e+09      5.747e+08  
       403|           3910      2.834e+09      5.744e+08  
       404|           3860      2.833e+09      5.741e+08  
       405|           3810      2.832e+09      5.739e+08  
       406|           3760      2.832e+09      5.736e+08  
       407|           3710      2.831e+09      5.733e+08  
       408|           3660      2.831e+09      5.730e+08  
       409|           3610      2.830e+09      5.727e+08  
       410|           3560      2.829e+09      5.724e+08  
       411|           3510      2.829e+09      5.721e+08  
       412|           3460      2.828e+09      5.718e+08  
       413|           3410      2.828e+09      5.716e+08  
       414|           3360      2.827e+09      5.713e+08  
       415|           3310      2.826e+09      5.710e+08  
       416|           3260      2.826e+09      5.706e+08  
       417|           3210      2.825e+09      5.703e+08  
       418|           3160      2.825e+09      5.700e+08  
       419|           3110      2.824e+09      5.697e+08  
       420|           3060      2.824e+09      5.694e+08  
       421|           3010      2.823e+09      5.691e+08  
       422|           2960      2.822e+09      5.688e+08  
       423|           2910      2.822e+09      5.685e+08  
       424|           2860      2.821e+09      5.681e+08  
       425|           2810      2.821e+09      5.678e+08  
       426|           2760      2.820e+09      5.675e+08  
       427|           2710      2.820e+09      5.672e+08  
       428|           2660      2.819e+09      5.668e+08  
       429|           2610      2.819e+09      5.665e+08  
       430|           2560      2.818e+09      5.661e+08  
       431|           2510      2.817e+09      5.658e+08  
       432|           2460      2.817e+09      5.655e+08  
       433|           2410      2.816e+09      5.651e+08  
       434|           2360      2.816e+09      5.648e+08  
       435|           2310      2.815e+09      5.644e+08  
       436|           2260      2.815e+09      5.640e+08  
       437|           2210      2.814e+09      5.637e+08  
       438|           2160      2.814e+09      5.633e+08  
       439|           2110      2.813e+09      5.630e+08  
       440|           2060      2.813e+09      5.626e+08  
       441|           2010      2.812e+09      5.622e+08  
       442|           1960      2.812e+09      5.618e+08  
       443|           1910      2.812e+09      5.614e+08  
       444|           1860      2.811e+09      5.611e+08  
       445|           1810      2.811e+09      5.607e+08  
       446|           1760      2.810e+09      5.603e+08  
       447|           1710      2.810e+09      5.599e+08  
       448|           1660      2.809e+09      5.595e+08  
       449|           1610      2.809e+09      5.591e+08  
       450|           1560      2.808e+09      5.587e+08  
       451|           1510      2.808e+09      5.583e+08  
       452|           1460      2.808e+09      5.579e+08  
       453|           1410      2.807e+09      5.574e+08  
       454|           1360      2.807e+09      5.570e+08  
       455|           1310      2.807e+09      5.566e+08  
       456|           1260      2.806e+09      5.562e+08  
       457|           1210      2.806e+09      5.557e+08  
       458|           1160      2.806e+09      5.553e+08  
       459|           1110      2.805e+09      5.548e+08  
       460|           1060      2.805e+09      5.544e+08  
       461|           1010      2.805e+09      5.539e+08  
       462|            960      2.804e+09      5.535e+08  
       463|            910      2.804e+09      5.530e+08  
       464|            860      2.804e+09      5.525e+08  
       465|            810      2.804e+09      5.521e+08  
       466|            760      2.803e+09      5.516e+08  
       467|            710      2.803e+09      5.511e+08  
       468|            660      2.803e+09      5.506e+08  
       469|            610      2.803e+09      5.501e+08  
       470|            560      2.803e+09      5.496e+08  
       471|            510      2.803e+09      5.491e+08  
       472|            460      2.802e+09      5.486e+08  
       473|            410      2.802e+09      5.481e+08  
       474|            360      2.802e+09      5.476e+08  
       475|            310      2.802e+09      5.470e+08  
       476|            260      2.802e+09      5.465e+08  
       477|            210      2.802e+09      5.460e+08  *
       478|            160      2.802e+09      5.454e+08  
       479|            110      2.802e+09      5.449e+08  
       480|             60      2.802e+09      5.443e+08  
       481|             10      2.802e+09      5.437e+08  
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse
Warning: lse is at the limit of the lambda range.

. graph export ..\Slides\figures\Stata_RidgeBasicCV.png , replace
file ..\Slides\figures\Stata_RidgeBasicCV.png saved as PNG format

. graph close     

. 
. local rbaseRMSE = sqrt(e(mspemin))

. display "Baseline - Ridge CV " `rbaseRMSE'
Baseline - Ridge CV 52935.355

. 
. * Store the model.
. est store cv_ridge_base

. * get the predictions (in-sample and out-of-sample)
. predict yhat_ridge_base, lopt
Estimate ridge with lambda=210 (lopt).

---------------------------------------------------
         Selected |           Ridge   Post-est OLS
------------------+--------------------------------
             e401 |    4364.3453369   4297.9028403
              age |   40402.1991081  40437.1907718
              inc |  230670.8983911 236003.1700406
             educ |  -12306.4361295 -13548.4820715
            fsize |  -14077.8118910 -14114.9567227
             marr |     770.2198556    802.4907393
          twoearn |  -19056.5586492 -19730.5610996
               db |   -3822.0682572  -3892.5016191
             pira |   27811.6020205  27959.4329523
             hown |    1558.9311850   1374.1731132
------------------+--------------------------------
   Partialled-out*|
------------------+--------------------------------
            _cons |  -31920.7847048 -31458.0592598
---------------------------------------------------
No xb or residuals options specified. Assume xb (fitted values).
Use e(b) from previous lasso2 estimation (lambda=210).

. 
. * Trick to get essentially OLS results for CV comparison        
. * Do lasso with a tiny penalty parameter
. cvlasso net_tfa e401 age inc educ fsize marr twoearn db pira hown if trdata, ///
>         lglmnet foldvar(fvar) lminratio(.0000000000001) lcount(2)
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=1.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      24339.432      3.478e+09      6.640e+08  
         2|      2.434e-09      2.802e+09      5.436e+08  *^
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse
Warning: lopt is at the limit of the lambda range.
Warning: lse is at the limit of the lambda range.

. 
. matrix mspe = e(mmspe)

. local mspebase = sqrt(mspe[2,1])

. display "Baseline - OLS CV " `mspebase'
Baseline - OLS CV 52937.279

. matrix drop mspe

. 
. *** Polynomial model
. * Lasso
. cvlasso net_tfa e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 ///
>         inc6 inc7 inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown ///
>         if trdata, lglmnet foldvar(fvar) plotcv
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=1.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      29207.769      3.438e+09      6.407e+08  
         2|      26613.031      3.340e+09      6.133e+08  
         3|      24248.803      3.259e+09      5.905e+08  
         4|      22094.606      3.176e+09      5.724e+08  
         5|      20131.782      3.088e+09      5.560e+08  
         6|       18343.33      3.015e+09      5.421e+08  
         7|      16713.759      2.954e+09      5.305e+08  
         8|      15228.955      2.902e+09      5.206e+08  ^
         9|      13876.056      2.859e+09      5.120e+08  
        10|      12643.346      2.814e+09      5.010e+08  
        11|      11520.146      2.762e+09      4.876e+08  
        12|      10496.728      2.715e+09      4.775e+08  
        13|      9564.2274      2.677e+09      4.707e+08  
        14|      8714.5678      2.648e+09      4.662e+08  
        15|      7940.3896      2.627e+09      4.630e+08  
        16|      7234.9873      2.611e+09      4.614e+08  
        17|       6592.251      2.599e+09      4.600e+08  
        18|      6006.6135      2.589e+09      4.589e+08  
        19|      5473.0026      2.585e+09      4.592e+08  
        20|      4986.7961      2.583e+09      4.606e+08  
        21|      4543.7829      2.581e+09      4.636e+08  
        22|      4140.1257      2.576e+09      4.653e+08  
        23|      3772.3284      2.573e+09      4.666e+08  
        24|      3437.2051      2.571e+09      4.682e+08  
        25|      3131.8533      2.571e+09      4.697e+08  
        26|      2853.6281      2.571e+09      4.715e+08  
        27|      2600.1196      2.572e+09      4.732e+08  
        28|      2369.1322      2.574e+09      4.750e+08  
        29|       2158.665      2.576e+09      4.767e+08  
        30|      1966.8951      2.578e+09      4.784e+08  
        31|      1792.1616      2.580e+09      4.800e+08  
        32|      1632.9509      2.583e+09      4.815e+08  
        33|       1487.884      2.586e+09      4.830e+08  
        34|      1355.7045      2.589e+09      4.844e+08  
        35|      1235.2675      2.592e+09      4.857e+08  
        36|      1125.5297      2.594e+09      4.869e+08  
        37|      1025.5408      2.596e+09      4.881e+08  
        38|      934.43454      2.599e+09      4.892e+08  
        39|      851.42195      2.601e+09      4.901e+08  
        40|      775.78397      2.602e+09      4.910e+08  
        41|      706.86546      2.604e+09      4.918e+08  
        42|      644.06948      2.606e+09      4.926e+08  
        43|      586.85212      2.607e+09      4.934e+08  
        44|       534.7178      2.609e+09      4.940e+08  
        45|      487.21494      2.610e+09      4.946e+08  
        46|      443.93211      2.611e+09      4.952e+08  
        47|      404.49441      2.613e+09      4.956e+08  
        48|      368.56024      2.614e+09      4.961e+08  
        49|      335.81836      2.615e+09      4.964e+08  
        50|      305.98518      2.616e+09      4.965e+08  
        51|       278.8023      2.618e+09      4.966e+08  
        52|      254.03428      2.619e+09      4.968e+08  
        53|      231.46657      2.620e+09      4.970e+08  
        54|      210.90372      2.621e+09      4.972e+08  
        55|      192.16761      2.622e+09      4.973e+08  
        56|      175.09597      2.622e+09      4.974e+08  
        57|      159.54093      2.623e+09      4.975e+08  
        58|      145.36775      2.624e+09      4.976e+08  
        59|      132.45368      2.625e+09      4.976e+08  
        60|      120.68686      2.626e+09      4.975e+08  
        61|      109.96537      2.627e+09      4.975e+08  
        62|      100.19635      2.627e+09      4.975e+08  
        63|      91.295185      2.628e+09      4.974e+08  
        64|      83.184772      2.628e+09      4.973e+08  
        65|      75.794866      2.637e+09      5.016e+08  
        66|      69.061459      2.644e+09      5.058e+08  
        67|       62.92623      2.652e+09      5.098e+08  
        68|      57.336037      2.617e+09      4.904e+08  
        69|      52.242461      2.616e+09      4.893e+08  
        70|      47.601385      2.622e+09      4.923e+08  
        71|      43.372609      2.577e+09      4.707e+08  
        72|      39.519506      2.545e+09      4.573e+08  
        73|      36.008702      2.528e+09      4.510e+08  
        74|      32.809788      2.511e+09      4.450e+08  
        75|      29.895057      2.503e+09      4.425e+08  *
        76|      27.239263      2.506e+09      4.438e+08  
        77|      24.819402      2.518e+09      4.480e+08  
        78|      22.614514      2.537e+09      4.547e+08  
        79|      20.605503      2.560e+09      4.640e+08  
        80|      18.774967      2.586e+09      4.757e+08  
        81|      17.107051      2.614e+09      4.894e+08  
        82|      15.587308      2.643e+09      5.048e+08  
        83|      14.202574      2.676e+09      5.240e+08  
        84|      12.940857      2.717e+09      5.493e+08  
        85|      11.791227      2.764e+09      5.801e+08  
        86|      10.743726      2.816e+09      6.168e+08  
        87|      9.7892834      2.873e+09      6.599e+08  
        88|      8.9196305      2.936e+09      7.094e+08  
        89|      8.1272351      3.012e+09      7.718e+08  
        90|      7.4052339      3.110e+09      8.556e+08  
        91|      6.7473734      3.231e+09      9.627e+08  
        92|      6.1479553      3.374e+09      1.093e+09  
        93|      5.6017879      3.542e+09      1.248e+09  
        94|      5.1041405      3.732e+09      1.428e+09  
        95|      4.6507027      3.942e+09      1.629e+09  
        96|      4.2375471      4.172e+09      1.850e+09  
        97|      3.8610951      4.348e+09      2.020e+09  
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse

. graph export ..\Slides\figures\Stata_LassoPolyCV.png , replace
file ..\Slides\figures\Stata_LassoPolyCV.png saved as PNG format

. graph close

. 
. local lpolyRMSE = sqrt(e(mspemin))

. display "Polynomial - Lasso CV " `lpolyRMSE'
Polynomial - Lasso CV 50025.513

. 
. * Store the model.
. est store cv_lasso_poly

. * get the predictions (in-sample and out-of-sample)
. predict yhat_lasso_poly, lopt
Estimate lasso with lambda=29.895 (lopt).
Warning: reached max shooting iterations w/o achieving convergence.

---------------------------------------------------
         Selected |           Lasso   Post-est OLS
------------------+--------------------------------
             e401 |    7610.0211064   7672.0621058
             age2 |    1871.7937945   6006.8773030
             age3 |    9067.2622189   2877.5596976
             age6 |   20671.4397598  23019.3707015
              inc |   37800.6496345-164313.8647712
             inc2 |  492118.28183591790484.4220195
             inc3 | -817878.3106191 -3.1906037e+06
             inc6 | 4335320.64974278687639.4772883
             inc8 |  -2.6187551e+06 -5.8507379e+06
             educ |  -21128.1373258 -27309.2895112
            educ2 |   16860.5241508  21201.7257623
            fsize |   -4146.3557644  -6469.1538785
           fsize2 |   -5275.3927321  -3499.7316863
             marr |    1820.5667689   2306.8701202
          twoearn |  -14421.9112080 -14830.5870622
               db |   -2676.7969445  -2530.3483183
             pira |   29467.1515197  29332.0118972
             hown |    4033.4279205   4128.3308230
------------------+--------------------------------
   Partialled-out*|
------------------+--------------------------------
            _cons |   -5702.3782221   4343.7933323
---------------------------------------------------
No xb or residuals options specified. Assume xb (fitted values).
Use e(b) from previous lasso2 estimation (lambda=29.89505716038).

. 
. * Ridge
. cvlasso net_tfa e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 ///
>         inc6 inc7 inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown ///
>         if trdata, lglmnet foldvar(fvar) plotcv alpha(0)
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=0.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      29207.769      2.552e+09      4.687e+08  ^
         2|      26613.031      2.552e+09      4.690e+08  
         3|      24248.803      2.552e+09      4.693e+08  
         4|      22094.606      2.552e+09      4.697e+08  
         5|      20131.782      2.553e+09      4.702e+08  
         6|       18343.33      2.554e+09      4.708e+08  
         7|      16713.759      2.556e+09      4.715e+08  
         8|      15228.955      2.558e+09      4.722e+08  
         9|      13876.056      2.559e+09      4.730e+08  
        10|      12643.346      2.562e+09      4.739e+08  
        11|      11520.146      2.564e+09      4.748e+08  
        12|      10496.728      2.567e+09      4.759e+08  
        13|      9564.2274      2.569e+09      4.770e+08  
        14|      8714.5678      2.572e+09      4.781e+08  
        15|      7940.3896      2.575e+09      4.793e+08  
        16|      7234.9873      2.578e+09      4.806e+08  
        17|       6592.251      2.581e+09      4.819e+08  
        18|      6006.6135      2.585e+09      4.833e+08  
        19|      5473.0026      2.588e+09      4.846e+08  
        20|      4986.7961      2.591e+09      4.860e+08  
        21|      4543.7829      2.595e+09      4.874e+08  
        22|      4140.1257      2.598e+09      4.888e+08  
        23|      3772.3284      2.601e+09      4.902e+08  
        24|      3437.2051      2.604e+09      4.915e+08  
        25|      3131.8533      2.607e+09      4.928e+08  
        26|      2853.6281      2.610e+09      4.941e+08  
        27|      2600.1196      2.613e+09      4.953e+08  
        28|      2369.1322      2.616e+09      4.965e+08  
        29|       2158.665      2.618e+09      4.976e+08  
        30|      1966.8951      2.621e+09      4.986e+08  
        31|      1792.1616      2.623e+09      4.995e+08  
        32|      1632.9509      2.625e+09      5.003e+08  
        33|       1487.884      2.627e+09      5.010e+08  
        34|      1355.7045      2.628e+09      5.016e+08  
        35|      1235.2675      2.630e+09      5.020e+08  
        36|      1125.5297      2.631e+09      5.023e+08  
        37|      1025.5408      2.632e+09      5.025e+08  
        38|      934.43454      2.632e+09      5.026e+08  
        39|      851.42195      2.633e+09      5.025e+08  
        40|      775.78397      2.633e+09      5.022e+08  
        41|      706.86546      2.632e+09      5.018e+08  
        42|      644.06948      2.632e+09      5.012e+08  
        43|      586.85212      2.631e+09      5.004e+08  
        44|       534.7178      2.629e+09      4.994e+08  
        45|      487.21494      2.628e+09      4.983e+08  
        46|      443.93211      2.626e+09      4.969e+08  
        47|      404.49441      2.623e+09      4.954e+08  
        48|      368.56024      2.620e+09      4.936e+08  
        49|      335.81836      2.617e+09      4.917e+08  
        50|      305.98518      2.613e+09      4.896e+08  
        51|       278.8023      2.609e+09      4.873e+08  
        52|      254.03428      2.605e+09      4.849e+08  
        53|      231.46657      2.600e+09      4.823e+08  
        54|      210.90372      2.594e+09      4.795e+08  
        55|      192.16761      2.589e+09      4.767e+08  
        56|      175.09597      2.583e+09      4.737e+08  
        57|      159.54093      2.576e+09      4.707e+08  
        58|      145.36775      2.570e+09      4.677e+08  
        59|      132.45368      2.563e+09      4.647e+08  
        60|      120.68686      2.556e+09      4.617e+08  
        61|      109.96537      2.549e+09      4.588e+08  
        62|      100.19635      2.542e+09      4.560e+08  
        63|      91.295185      2.535e+09      4.533e+08  
        64|      83.184772      2.529e+09      4.509e+08  
        65|      75.794866      2.523e+09      4.487e+08  
        66|      69.061459      2.517e+09      4.467e+08  
        67|       62.92623      2.512e+09      4.451e+08  
        68|      57.336037      2.508e+09      4.438e+08  
        69|      52.242461      2.505e+09      4.428e+08  
        70|      47.601385      2.503e+09      4.422e+08  
        71|      43.372609      2.502e+09      4.420e+08  *
        72|      39.519506      2.502e+09      4.422e+08  
        73|      36.008702      2.504e+09      4.429e+08  
        74|      32.809788      2.508e+09      4.441e+08  
        75|      29.895057      2.513e+09      4.460e+08  
        76|      27.239263      2.520e+09      4.485e+08  
        77|      24.819402      2.529e+09      4.517e+08  
        78|      22.614514      2.539e+09      4.559e+08  
        79|      20.605503      2.552e+09      4.610e+08  
        80|      18.774967      2.567e+09      4.672e+08  
        81|      17.107051      2.584e+09      4.748e+08  
        82|      15.587308      2.602e+09      4.837e+08  
        83|      14.202574      2.623e+09      4.943e+08  
        84|      12.940857      2.646e+09      5.065e+08  
        85|      11.791227      2.671e+09      5.207e+08  
        86|      10.743726      2.698e+09      5.368e+08  
        87|      9.7892834      2.727e+09      5.552e+08  
        88|      8.9196305      2.758e+09      5.758e+08  
        89|      8.1272351      2.792e+09      5.989e+08  
        90|      7.4052339      2.828e+09      6.247e+08  
        91|      6.7473734      2.866e+09      6.533e+08  
        92|      6.1479553      2.907e+09      6.848e+08  
        93|      5.6017879      2.951e+09      7.196e+08  
        94|      5.1041405      2.999e+09      7.577e+08  
        95|      4.6507027      3.049e+09      7.996e+08  
        96|      4.2375471      3.103e+09      8.454e+08  
        97|      3.8610951      3.161e+09      8.954e+08  
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse
Warning: lse is at the limit of the lambda range.

. graph export ..\Slides\figures\Stata_RidgePolyCV.png , replace
file ..\Slides\figures\Stata_RidgePolyCV.png saved as PNG format

. graph close

. 
. local rpolyRMSE = sqrt(e(mspemin))

. display "Polynomial - Lasso CV " `rpolyRMSE'
Polynomial - Lasso CV 50018.393

. 
. * Store the model.
. est store cv_ridge_poly

. * get the predictions (in-sample and out-of-sample)
. predict yhat_ridge_poly, lopt
Estimate ridge with lambda=43.373 (lopt).

---------------------------------------------------
         Selected |           Ridge   Post-est OLS
------------------+--------------------------------
             e401 |    7615.9134627   7636.5877492
              age |   -2479.5604385 -7.7753818e+06
             age2 |    7599.5726860  3.0477701e+07
             age3 |    4249.0328426 -6.3186900e+07
             age4 |     314.6755412  7.3082741e+07
             age5 |    3276.6295267 -4.4633175e+07
             age6 |   18493.2024659  1.1250046e+07
              inc |    7843.0382926-547704.3388063
             inc2 |  657381.4229396  1.2722440e+07
             inc3 | -898259.3738229 -1.2607799e+08
             inc4 | -983135.4574307  6.6816159e+08
             inc5 | 1681731.9549706 -1.9215628e+09
             inc6 | 3253025.0822043  2.9849698e+09
             inc7 | 1306522.9509573 -2.3362714e+09
             inc8 |  -3.6265766e+06  7.2062590e+08
             educ |  -65591.8453212-287903.4855384
            educ2 |   71606.4997902 748752.6808123
            educ3 |    9529.9023068-789240.2287663
            educ4 |  -28554.5568824 295881.7469064
            fsize |   -5201.3598461  -6800.6621320
           fsize2 |   -4203.7135132  -1710.3601466
             marr |    2073.0954024   2532.3165078
          twoearn |  -14634.7115813 -14677.9098945
               db |   -2722.5935768  -2532.3976735
             pira |   29393.2365843  29313.0807042
             hown |    4089.0533962   4113.0096797
------------------+--------------------------------
   Partialled-out*|
------------------+--------------------------------
            _cons |    3850.9817311 853141.5419916
---------------------------------------------------
No xb or residuals options specified. Assume xb (fitted values).
Use e(b) from previous lasso2 estimation (lambda=43.37260926305999).

. 
. * Trick to get essentially OLS results for CV comparison        
. * Do lasso with a tiny penalty parameter
. cvlasso net_tfa e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 ///
>         inc6 inc7 inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown /// 
>         if trdata, lglmnet foldvar(fvar) lminratio(.0000000000001) lcount(2)
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=1.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      29207.769      3.438e+09      6.407e+08  ^
         2|      2.921e-09      3.184e+09      9.133e+08  *
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse
Warning: lopt is at the limit of the lambda range.
Warning: lse is at the limit of the lambda range.

. 
. matrix mspe = e(mmspe)

. local mspepoly = sqrt(mspe[2,1])

. display "Polynomial - OLS CV " `mspepoly'
Polynomial - OLS CV 56428.603

. matrix drop mspe

. 
. *** Interaction model
. * Lasso
. cvlasso net_tfa /// 
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown)## ///
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown) ///
>         if trdata, lglmnet foldvar(fvar) plotcv
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=1.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      32521.819      3.352e+09      6.327e+08  
         2|       29632.67      3.231e+09      6.062e+08  
         3|      27000.186      3.129e+09      5.849e+08  
         4|      24601.564      3.037e+09      5.648e+08  
         5|      22416.029      2.950e+09      5.431e+08  ^
         6|       20424.65      2.874e+09      5.272e+08  
         7|      18610.181      2.809e+09      5.135e+08  
         8|      16956.904      2.750e+09      5.014e+08  
         9|      15450.499      2.696e+09      4.916e+08  
        10|      14077.919      2.653e+09      4.834e+08  
        11|      12827.276      2.618e+09      4.771e+08  
        12|      11687.736      2.592e+09      4.739e+08  
        13|       10649.43      2.564e+09      4.690e+08  
        14|      9703.3636      2.544e+09      4.667e+08  
        15|      8841.3435      2.532e+09      4.674e+08  
        16|       8055.903      2.528e+09      4.726e+08  *
        17|      7340.2387      2.528e+09      4.814e+08  
        18|      6688.1522      2.532e+09      4.929e+08  
        19|      6093.9952      2.536e+09      5.034e+08  
        20|      5552.6214      2.542e+09      5.135e+08  
        21|      5059.3418      2.553e+09      5.280e+08  
        22|      4609.8839      2.564e+09      5.435e+08  
        23|      4200.3545      2.574e+09      5.563e+08  
        24|      3827.2066      2.594e+09      5.710e+08  
        25|      3487.2081      2.621e+09      5.878e+08  
        26|      3177.4141      2.655e+09      6.049e+08  
        27|      2895.1414      2.692e+09      6.221e+08  
        28|       2637.945      2.728e+09      6.399e+08  
        29|      2403.5973      2.771e+09      6.594e+08  
        30|      2190.0683      2.825e+09      6.841e+08  
        31|      1995.5087      2.852e+09      6.992e+08  
        32|      1818.2332      2.878e+09      7.122e+08  
        33|      1656.7064      2.910e+09      7.263e+08  
        34|      1509.5291      2.945e+09      7.429e+08  
        35|      1375.4267      2.998e+09      7.682e+08  
        36|      1253.2376      3.076e+09      8.095e+08  
        37|      1141.9034      3.236e+09      9.015e+08  
        38|      1040.4599      3.330e+09      9.569e+08  
        39|      948.02829      3.393e+09      9.938e+08  
        40|      863.80807      3.435e+09      1.014e+09  
        41|      787.06974      3.433e+09      1.006e+09  
        42|      717.14863      3.457e+09      1.017e+09  
        43|      653.43913      3.479e+09      1.028e+09  
        44|      595.38939      3.488e+09      1.031e+09  
        45|      542.49664      3.506e+09      1.036e+09  
        46|      494.30274      3.519e+09      1.042e+09  
        47|      450.39024      3.581e+09      1.078e+09  
        48|      410.37881      3.114e+09      8.637e+08  
        49|      373.92189      4.045e+09      1.401e+09  
        50|       340.7037      5.169e+09      2.375e+09  
        51|      310.43652      6.326e+09      3.476e+09  
        52|       282.8582      8.010e+09      5.130e+09  
        53|      257.72986      1.007e+10      7.164e+09  
        54|      234.83385      1.352e+10      1.058e+10  
        55|      213.97185      1.810e+10      1.512e+10  
        56|      194.96318      2.276e+10      1.974e+10  
        57|      177.64319      2.824e+10      2.521e+10  
        58|      161.86186      3.502e+10      3.201e+10  
        59|       147.4825      4.147e+10      3.848e+10  
        60|      134.38056      5.437e+10      5.139e+10  
        61|      122.44256      6.132e+10      5.835e+10  
        62|       111.5651      6.721e+10      6.423e+10  
        63|      101.65397      7.458e+10      7.159e+10  
        64|      92.623308      8.390e+10      8.091e+10  
        65|      84.394908      8.448e+10      8.143e+10  
        66|      76.897497      8.216e+10      7.907e+10  
        67|      70.066136      7.748e+10      7.435e+10  
        68|      63.841653      7.460e+10      7.145e+10  
        69|      58.170137      7.635e+10      7.318e+10  
        70|      53.002462      8.434e+10      8.114e+10  
        71|      48.293869      8.292e+10      7.971e+10  
        72|      44.003575      7.875e+10      7.552e+10  
        73|      40.094419      7.878e+10      7.552e+10  
        74|      36.532541      8.037e+10      7.709e+10  
        75|      33.287091      7.705e+10      7.377e+10  
        76|      30.329957      6.414e+10      6.088e+10  
        77|      27.635528      5.142e+10      4.816e+10  
        78|      25.180464      3.954e+10      3.630e+10  
        79|      22.943501      3.240e+10      2.918e+10  
        80|      20.905263      2.912e+10      2.590e+10  
        81|      19.048097      2.336e+10      2.018e+10  
        82|      17.355917      1.904e+10      1.590e+10  
        83|      15.814065      1.558e+10      1.248e+10  
        84|      14.409187      1.203e+10      8.984e+09  
        85|      13.129115      9.910e+09      6.911e+09  
        86|       11.96276      8.519e+09      5.557e+09  
        87|      10.900022      7.204e+09      4.281e+09  
        88|      9.9316937      6.209e+09      3.317e+09  
        89|      9.0493894      5.453e+09      2.598e+09  
        90|      8.2454666      4.667e+09      1.883e+09  
        91|      7.5129621      3.596e+09      1.029e+09  
        92|      6.8455312      3.126e+09      8.185e+08  
        93|      6.2373931      3.203e+09      8.211e+08  
        94|      5.6832803      3.179e+09      7.997e+08  
        95|      5.1783933      3.015e+09      7.539e+08  
        96|      4.7183591      2.949e+09      7.342e+08  
        97|      4.2991931      2.970e+09      7.167e+08  
        98|      3.9172646      3.079e+09      7.069e+08  
        99|      3.5692656      3.383e+09      7.962e+08  
       100|      3.2521819      3.890e+09      1.116e+09  
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse

. graph export ..\Slides\figures\Stata_LassoIntCV.png , replace
file ..\Slides\figures\Stata_LassoIntCV.png saved as PNG format

. graph close

. 
. local lintRMSE = sqrt(e(mspemin))

. display "Interactions - Lasso CV " `lintRMSE'
Interactions - Lasso CV 50276.663

. 
. * Store the model.
. est store cv_lasso_int

. * get the predictions (in-sample and out-of-sample)
. predict yhat_lasso_int, lopt
Estimate lasso with lambda=8055.903 (lopt).

---------------------------------------------------
         Selected |           Lasso   Post-est OLS
------------------+--------------------------------
     c.age2#c.inc |    4589.9041728 325594.2428717
                  |
    c.age2#c.pira |   13489.4339528 -35854.6333163
                  |
    c.age3#c.inc2 |  199204.8829589 -1.5166477e+06
                  |
    c.age3#c.inc3 | 1013472.95060923041275.9149123
                  |
    c.age3#c.pira |    4585.7553440  77708.7510441
                  |
     c.inc#c.pira |   60543.0002772 102453.4184857
------------------+--------------------------------
   Partialled-out*|
------------------+--------------------------------
                  |
            _cons |    6616.6797825  -6004.4826829
---------------------------------------------------
No xb or residuals options specified. Assume xb (fitted values).
Use e(b) from previous lasso2 estimation (lambda=8055.902951453999).

. 
. * Ridge
. cvlasso net_tfa /// 
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown)## ///
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown) ///
>         if trdata, lglmnet foldvar(fvar) plotcv alpha(0)
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=0.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      32521.819      2.957e+09      7.683e+08  *^
         2|       29632.67      3.054e+09      8.391e+08  
         3|      27000.186      3.164e+09      9.232e+08  
         4|      24601.564      3.287e+09      1.022e+09  
         5|      22416.029      3.425e+09      1.137e+09  
         6|       20424.65      3.580e+09      1.270e+09  
         7|      18610.181      3.754e+09      1.422e+09  
         8|      16956.904      3.947e+09      1.596e+09  
         9|      15450.499      4.162e+09      1.792e+09  
        10|      14077.919      4.401e+09      2.013e+09  
        11|      12827.276      4.666e+09      2.261e+09  
        12|      11687.736      4.960e+09      2.538e+09  
        13|       10649.43      5.284e+09      2.847e+09  
        14|      9703.3636      5.642e+09      3.190e+09  
        15|      8841.3435      6.037e+09      3.570e+09  
        16|       8055.903      6.471e+09      3.991e+09  
        17|      7340.2387      6.948e+09      4.455e+09  
        18|      6688.1522      7.470e+09      4.965e+09  
        19|      6093.9952      8.043e+09      5.525e+09  
        20|      5552.6214      8.668e+09      6.138e+09  
        21|      5059.3418      9.350e+09      6.809e+09  
        22|      4609.8839      1.009e+10      7.540e+09  
        23|      4200.3545      1.090e+10      8.335e+09  
        24|      3827.2066      1.177e+10      9.197e+09  
        25|      3487.2081      1.271e+10      1.013e+10  
        26|      3177.4141      1.373e+10      1.114e+10  
        27|      2895.1414      1.483e+10      1.222e+10  
        28|       2637.945      1.600e+10      1.339e+10  
        29|      2403.5973      1.725e+10      1.463e+10  
        30|      2190.0683      1.859e+10      1.596e+10  
        31|      1995.5087      2.001e+10      1.737e+10  
        32|      1818.2332      2.152e+10      1.887e+10  
        33|      1656.7064      2.311e+10      2.046e+10  
        34|      1509.5291      2.479e+10      2.212e+10  
        35|      1375.4267      2.655e+10      2.387e+10  
        36|      1253.2376      2.838e+10      2.570e+10  
        37|      1141.9034      3.029e+10      2.760e+10  
        38|      1040.4599      3.227e+10      2.957e+10  
        39|      948.02829      3.431e+10      3.161e+10  
        40|      863.80807      3.641e+10      3.370e+10  
        41|      787.06974      3.856e+10      3.584e+10  
        42|      717.14863      4.074e+10      3.801e+10  
        43|      653.43913      4.296e+10      4.022e+10  
        44|      595.38939      4.519e+10      4.245e+10  
        45|      542.49664      4.743e+10      4.468e+10  
        46|      494.30274      4.966e+10      4.691e+10  
        47|      450.39024      5.188e+10      4.911e+10  
        48|      410.37881      5.406e+10      5.129e+10  
        49|      373.92189      5.619e+10      5.342e+10  
        50|       340.7037      5.827e+10      5.549e+10  
        51|      310.43652      6.027e+10      5.749e+10  
        52|       282.8582      6.219e+10      5.940e+10  
        53|      257.72986      6.401e+10      6.122e+10  
        54|      234.83385      6.573e+10      6.293e+10  
        55|      213.97185      6.732e+10      6.452e+10  
        56|      194.96318      6.879e+10      6.599e+10  
        57|      177.64319      7.012e+10      6.732e+10  
        58|      161.86186      7.131e+10      6.850e+10  
        59|       147.4825      7.235e+10      6.954e+10  
        60|      134.38056      7.323e+10      7.042e+10  
        61|      122.44256      7.396e+10      7.115e+10  
        62|       111.5651      7.453e+10      7.172e+10  
        63|      101.65397      7.493e+10      7.213e+10  
        64|      92.623308      7.518e+10      7.238e+10  
        65|      84.394908      7.527e+10      7.247e+10  
        66|      76.897497      7.521e+10      7.240e+10  
        67|      70.066136      7.499e+10      7.219e+10  
        68|      63.841653      7.462e+10      7.183e+10  
        69|      58.170137      7.411e+10      7.132e+10  
        70|      53.002462      7.347e+10      7.068e+10  
        71|      48.293869      7.269e+10      6.990e+10  
        72|      44.003575      7.179e+10      6.900e+10  
        73|      40.094419      7.077e+10      6.798e+10  
        74|      36.532541      6.963e+10      6.685e+10  
        75|      33.287091      6.840e+10      6.562e+10  
        76|      30.329957      6.706e+10      6.429e+10  
        77|      27.635528      6.564e+10      6.286e+10  
        78|      25.180464      6.414e+10      6.136e+10  
        79|      22.943501      6.256e+10      5.978e+10  
        80|      20.905263      6.091e+10      5.813e+10  
        81|      19.048097      5.921e+10      5.643e+10  
        82|      17.355917      5.745e+10      5.467e+10  
        83|      15.814065      5.565e+10      5.286e+10  
        84|      14.409187      5.382e+10      5.102e+10  
        85|      13.129115      5.196e+10      4.915e+10  
        86|       11.96276      5.007e+10      4.726e+10  
        87|      10.900022      4.817e+10      4.535e+10  
        88|      9.9316937      4.627e+10      4.344e+10  
        89|      9.0493894      4.436e+10      4.151e+10  
        90|      8.2454666      4.245e+10      3.959e+10  
        91|      7.5129621      4.055e+10      3.767e+10  
        92|      6.8455312      3.866e+10      3.577e+10  
        93|      6.2373931      3.678e+10      3.387e+10  
        94|      5.6832803      3.492e+10      3.199e+10  
        95|      5.1783933      3.308e+10      3.013e+10  
        96|      4.7183591      3.126e+10      2.829e+10  
        97|      4.2991931      2.947e+10      2.648e+10  
        98|      3.9172646      2.771e+10      2.469e+10  
        99|      3.5692656      2.598e+10      2.294e+10  
       100|      3.2521819      2.428e+10      2.122e+10  
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse
Warning: lopt is at the limit of the lambda range.
Warning: lse is at the limit of the lambda range.

. graph export ..\Slides\figures\Stata_RidgeIntCV.png , replace
file ..\Slides\figures\Stata_RidgeIntCV.png saved as PNG format

. graph close

. 
. local rintRMSE = sqrt(e(mspemin))

. display "Interactions - Ridge CV " `rintRMSE'
Interactions - Ridge CV 54382.019

. 
. * Store the model.
. est store cv_ridge_int

. * get the predictions (in-sample and out-of-sample)
. predict yhat_ridge_int, lopt
Estimate ridge with lambda=32521.819 (lopt).

---------------------------------------------------
         Selected |           Ridge   Post-est OLS
------------------+--------------------------------
             e401 |     383.02941781599165.0836289
              age |    1225.0200496  7.0150240e+11
             age2 |     656.2682582 -6.2517850e+12
             age3 |     403.3621104  3.3419306e+13
             age4 |     245.0805131      (omitted)
             age5 |     154.7235924  4.6465006e+12
             age6 |     131.1509652 -1.0485759e+13
              inc |    7886.7686565 -8.3827579e+07
             inc2 |   11230.9875736  7.3025501e+11
             inc3 |   18724.1943908 -4.3384558e+13
             inc4 |   36363.2701334  7.4704482e+14
             inc5 |   52281.7498626 -4.8393531e+15
             inc6 |   52090.1401019  1.3829318e+16
             inc7 |   35345.4040371 -1.7559806e+16
             inc8 |    9355.8411650  7.0940965e+15
             educ |   -2554.0028998 -1.5644870e+08
            educ2 |    -391.9047029 -5.9058212e+11
            educ3 |      67.5528408  2.7295849e+12
            educ4 |     163.9474976  2.6867703e+12
            fsize |     -72.1956342  7.5077757e+07
           fsize2 |     626.3833273 -1.5210359e+11
             marr |     121.53694383821332.5700378
          twoearn |      52.5470449 -1.0854074e+07
               db |     169.6441991 -1.6337631e+07
             pira |    1676.49205538585292.0897096
             hown |     -53.79865153486401.9731362
                  |
    c.e401#c.e401 |     383.0294178      (omitted)
                  |
     c.e401#c.age |    1232.6273725 -1.6253243e+07
                  |
    c.e401#c.age2 |    1783.3831320  6.4431904e+07
                  |
    c.e401#c.age3 |    1737.3516393 -1.3061580e+08
                  |
    c.e401#c.age4 |    1171.9563035  1.4339469e+08
                  |
    c.e401#c.age5 |     296.9268443 -8.1004150e+07
                  |
    c.e401#c.age6 |    -698.1673170  1.8403623e+07
                  |
     c.e401#c.inc |    9349.91785121773963.3539387
                  |
    c.e401#c.inc2 |   31878.3737919 -5.4096447e+07
                  |
    c.e401#c.inc3 |   72289.0067124  7.3098468e+08
                  |
    c.e401#c.inc4 |  136281.2478456 -5.1348389e+09
                  |
    c.e401#c.inc5 |  210880.4726716  2.0087528e+10
                  |
    c.e401#c.inc6 |  263988.2261609 -4.3885812e+10
                  |
    c.e401#c.inc7 |  257387.9922340  4.9865247e+10
                  |
    c.e401#c.inc8 |  154481.0609969 -2.2882682e+10
                  |
    c.e401#c.educ |     285.3047830 131411.6701194
                  |
   c.e401#c.educ2 |    -121.8178214-239198.7211664
                  |
   c.e401#c.educ3 |    -660.8582690 133112.0523396
                  |
   c.e401#c.educ4 |   -1227.2977628 -12316.7918248
                  |
   c.e401#c.fsize |    -293.9021811 -22782.7941721
                  |
  c.e401#c.fsize2 |   -3516.6212405   8049.9794511
                  |
    c.e401#c.marr |     189.3945181  -1149.2587802
                  |
 c.e401#c.twoearn |    -507.9331063   3598.0751184
                  |
      c.e401#c.db |     628.7881994    870.5167410
                  |
    c.e401#c.pira |    1827.5717862  -1204.5258918
                  |
    c.e401#c.hown |    1577.1796393   3517.8399363
                  |
      c.age#c.age |     656.2682582      (omitted)
                  |
     c.age#c.age2 |     403.3621104      (omitted)
                  |
     c.age#c.age3 |     245.0805131      (omitted)
                  |
     c.age#c.age4 |     154.7235513  2.9541145e+14
                  |
     c.age#c.age5 |     131.1511265 -3.5127426e+13
                  |
     c.age#c.age6 |     174.3884417  4.5696081e+13
                  |
      c.age#c.inc |   13471.5644844  1.8029594e+09
                  |
     c.age#c.inc2 |   17078.4700940 -7.1462609e+10
                  |
     c.age#c.inc3 |   24252.9256541  8.6577244e+11
                  |
     c.age#c.inc4 |   41522.5719326 -4.9391401e+12
                  |
     c.age#c.inc5 |   52975.9495364  1.1141422e+13
                  |
     c.age#c.inc6 |   46693.9664191  3.1493136e+12
                  |
     c.age#c.inc7 |   25640.5843712 -4.3037866e+13
                  |
     c.age#c.inc8 |   -2433.8936022  3.8899210e+13
                  |
     c.age#c.educ |    -825.7485174  7.8968664e+08
                  |
    c.age#c.educ2 |     734.8606869 -1.7394983e+09
                  |
    c.age#c.educ3 |    1101.9298365  1.0417185e+09
                  |
    c.age#c.educ4 |     989.1556272  8.1442812e+07
                  |
    c.age#c.fsize |     706.6857395 -7.6747206e+08
                  |
   c.age#c.fsize2 |     949.0561853  1.5919562e+09
                  |
     c.age#c.marr |     366.9763842 -2.8782949e+07
                  |
  c.age#c.twoearn |      58.7683619  9.7793988e+07
                  |
       c.age#c.db |     239.0981337  1.5711298e+08
                  |
     c.age#c.pira |    3475.7482624 -7.9741677e+07
                  |
     c.age#c.hown |     673.7596698 -3.0325032e+07
                  |
    c.age2#c.age2 |     245.0805131 -1.1935497e+14
                  |
    c.age2#c.age3 |     154.7235513      (omitted)
                  |
    c.age2#c.age4 |     131.1510963      (omitted)
                  |
    c.age2#c.age5 |     174.3885799  1.2632193e+14
                  |
    c.age2#c.age6 |     281.2406087 -8.2566445e+13
                  |
     c.age2#c.inc |   15544.4281878 -9.7617562e+09
                  |
    c.age2#c.inc2 |   19114.0752352  3.8348805e+11
                  |
    c.age2#c.inc3 |   26331.9752057 -5.0468641e+12
                  |
    c.age2#c.inc4 |   44813.7711459  3.2591911e+13
                  |
    c.age2#c.inc5 |   54245.1473492 -1.0093796e+14
                  |
    c.age2#c.inc6 |   44417.9624477  1.2374551e+14
                  |
    c.age2#c.inc7 |   20372.5275266  1.9149852e+12
                  |
    c.age2#c.inc8 |   -9741.6339660 -7.0307115e+13
                  |
    c.age2#c.educ |    -297.3033256  4.4096968e+08
                  |
   c.age2#c.educ2 |    1022.4944835 -2.7134682e+09
                  |
   c.age2#c.educ3 |    1488.4246886  6.5146661e+09
                  |
   c.age2#c.educ4 |    1254.3615427 -4.5139924e+09
                  |
   c.age2#c.fsize |     297.0997172  3.2095019e+09
                  |
  c.age2#c.fsize2 |    -759.7343394 -6.5724025e+09
                  |
    c.age2#c.marr |     265.1411173  8.6682844e+07
                  |
 c.age2#c.twoearn |    -252.5212657 -3.6391561e+08
                  |
      c.age2#c.db |    -120.7100903 -6.1662574e+08
                  |
    c.age2#c.pira |    5077.8669898  3.0883336e+08
                  |
    c.age2#c.hown |    1123.0125937  1.1207318e+08
                  |
    c.age3#c.age3 |     131.1510963 -4.9891832e+14
                  |
    c.age3#c.age4 |     174.3885586  5.4681217e+14
                  |
    c.age3#c.age5 |     281.2407258 -2.8176386e+14
                  |
    c.age3#c.age6 |     445.5212093  9.3502995e+13
                  |
     c.age3#c.inc |   15239.4787569  2.4809658e+10
                  |
    c.age3#c.inc2 |   17863.3844135 -9.8156736e+11
                  |
    c.age3#c.inc3 |   26892.3195141  1.3557504e+13
                  |
    c.age3#c.inc4 |   48957.6498310 -9.2910857e+13
                  |
    c.age3#c.inc5 |   58231.5508942  3.2090512e+14
                  |
    c.age3#c.inc6 |   45895.9287228 -5.2610297e+14
                  |
    c.age3#c.inc7 |   18956.0481786  3.3122562e+14
                  |
    c.age3#c.inc8 |  -13697.4466246 -2.1479083e+13
                  |
    c.age3#c.educ |    -310.3064323 -8.4579727e+09
                  |
   c.age3#c.educ2 |     857.1411016  2.5723738e+10
                  |
   c.age3#c.educ3 |    1309.4563878 -3.5561160e+10
                  |
   c.age3#c.educ4 |     915.5252545  1.7965046e+10
                  |
   c.age3#c.fsize |   -1185.4213708 -7.0011429e+09
                  |
  c.age3#c.fsize2 |   -5212.7761985  1.4143129e+10
                  |
    c.age3#c.marr |    -141.8395885 -1.2115771e+08
                  |
 c.age3#c.twoearn |   -1020.1225670  7.0720284e+08
                  |
      c.age3#c.db |   -1067.3052716  1.2667377e+09
                  |
    c.age3#c.pira |    6231.8165127 -6.2720569e+08
                  |
    c.age3#c.hown |    1214.3147456 -2.1721491e+08
                  |
    c.age4#c.age4 |     281.2407126 -3.2084263e+14
                  |
    c.age4#c.age5 |     445.5213068  3.6646926e+14
                  |
    c.age4#c.age6 |     659.2283178 -8.8021187e+13
                  |
     c.age4#c.inc |   14016.8453627 -3.2517183e+10
                  |
    c.age4#c.inc2 |   15094.5746759  1.3065106e+12
                  |
    c.age4#c.inc3 |   27976.8353696 -1.8666765e+13
                  |
    c.age4#c.inc4 |   55471.0557353  1.3266073e+14
                  |
    c.age4#c.inc5 |   65589.4347545 -4.8471751e+14
                  |
    c.age4#c.inc6 |   50986.8594719  8.8816640e+14
                  |
    c.age4#c.inc7 |   20809.9467727 -7.3714626e+14
                  |
    c.age4#c.inc8 |  -15014.1737070  2.0421937e+14
                  |
    c.age4#c.educ |    -379.0778714  1.8252140e+10
                  |
   c.age4#c.educ2 |     670.9370798 -5.2007963e+10
                  |
   c.age4#c.educ3 |    1010.4894696  6.5185509e+10
                  |
   c.age4#c.educ4 |     377.2445479 -3.0013391e+10
                  |
   c.age4#c.fsize |   -3106.2919108  8.4034638e+09
                  |
  c.age4#c.fsize2 |  -11818.7651246 -1.6742498e+10
                  |
    c.age4#c.marr |    -675.5384458  7.0992483e+07
                  |
 c.age4#c.twoearn |   -2215.7266680 -7.5870010e+08
                  |
      c.age4#c.db |   -2543.0325093 -1.4383607e+09
                  |
    c.age4#c.pira |    7004.0073616  7.0537410e+08
                  |
    c.age4#c.hown |    1127.7997928  2.3357876e+08
                  |
    c.age5#c.age5 |     659.2283948 -1.1845621e+14
                  |
    c.age5#c.age6 |     913.6292178  5.5658019e+13
                  |
     c.age5#c.inc |   12757.0520801  2.1286397e+10
                  |
    c.age5#c.inc2 |   12438.8445068 -8.7328544e+11
                  |
    c.age5#c.inc3 |   30937.3992874  1.2813809e+13
                  |
    c.age5#c.inc4 |   65061.8747689 -9.3443272e+13
                  |
    c.age5#c.inc5 |   76495.1936783  3.5367774e+14
                  |
    c.age5#c.inc6 |   59503.3773952 -6.8792951e+14
                  |
    c.age5#c.inc7 |   25575.8254904  6.3835652e+14
                  |
    c.age5#c.inc8 |  -14088.9476205 -2.2177418e+14
                  |
    c.age5#c.educ |    -377.4901709 -1.5900884e+10
                  |
   c.age5#c.educ2 |     623.8531161  4.4066151e+10
                  |
   c.age5#c.educ3 |     852.8633675 -5.2889447e+10
                  |
   c.age5#c.educ4 |     -28.6135284  2.3260682e+10
                  |
   c.age5#c.fsize |   -5037.5603801 -5.2640854e+09
                  |
  c.age5#c.fsize2 |  -19480.9547380  1.0346127e+10
                  |
    c.age5#c.marr |   -1212.9047766 -2.3347137e+06
                  |
 c.age5#c.twoearn |   -3726.5132482  4.2705630e+08
                  |
      c.age5#c.db |   -4389.4011030  8.5700913e+08
                  |
    c.age5#c.pira |    7547.9240835 -4.1670955e+08
                  |
    c.age5#c.hown |    1006.1813011 -1.3246180e+08
                  |
    c.age6#c.age6 |    1200.0278229 -6.8149203e+12
                  |
     c.age6#c.inc |   11934.9421500 -5.5068443e+09
                  |
    c.age6#c.inc2 |   10984.8461414  2.3166893e+11
                  |
    c.age6#c.inc3 |   36489.6779628 -3.4774605e+12
                  |
    c.age6#c.inc4 |   78043.0141870  2.5878307e+13
                  |
    c.age6#c.inc5 |   91015.1780026 -1.0043227e+14
                  |
    c.age6#c.inc6 |   71352.8933816  2.0292923e+14
                  |
    c.age6#c.inc7 |   33082.6123829 -2.0026122e+14
                  |
    c.age6#c.inc8 |  -11116.9102789  7.6703781e+13
                  |
    c.age6#c.educ |    -258.1459054  5.0482637e+09
                  |
   c.age6#c.educ2 |     778.9738554 -1.3754145e+10
                  |
   c.age6#c.educ3 |     958.0299343  1.6090435e+10
                  |
   c.age6#c.educ4 |    -119.0027779 -6.8802202e+09
                  |
   c.age6#c.fsize |   -6733.0690999  1.3451457e+09
                  |
  c.age6#c.fsize2 |  -27202.7489721 -2.6098216e+09
                  |
    c.age6#c.marr |   -1687.2937752 -9.0893764e+06
                  |
 c.age6#c.twoearn |   -5421.7932478 -9.8761146e+07
                  |
      c.age6#c.db |   -6439.4923946 -2.0958308e+08
                  |
    c.age6#c.pira |    7990.5947895  1.0108105e+08
                  |
    c.age6#c.hown |     925.4245357  3.1013161e+07
                  |
      c.inc#c.inc |   11230.9844588 -7.2668855e+11
                  |
     c.inc#c.inc2 |   18724.2028007  4.3358399e+13
                  |
     c.inc#c.inc3 |   36363.2533581 -1.4229584e+14
                  |
     c.inc#c.inc4 |   52281.7482431 -4.6483157e+15
                  |
     c.inc#c.inc5 |   52090.1582087  4.3105445e+16
                  |
     c.inc#c.inc6 |   35345.3885216 -1.4219690e+17
                  |
     c.inc#c.inc7 |    9355.8523624  2.0239128e+17
                  |
     c.inc#c.inc8 |  -19013.5802957 -1.0315941e+17
                  |
     c.inc#c.educ |    6845.6263692 -1.3956626e+08
                  |
    c.inc#c.educ2 |    5111.5729419  3.0308544e+08
                  |
    c.inc#c.educ3 |    2763.7517315 -2.6105390e+08
                  |
    c.inc#c.educ4 |     245.2086012  7.2752810e+07
                  |
    c.inc#c.fsize |    6366.1334308 -2.6415629e+07
                  |
   c.inc#c.fsize2 |    -843.9226285  3.2619666e+07
                  |
     c.inc#c.marr |    2402.94529282783657.5494516
                  |
  c.inc#c.twoearn |   -9691.4449717 -4.1550718e+06
                  |
       c.inc#c.db |    1986.0309820-508484.9684226
                  |
     c.inc#c.pira |   16070.11802812262524.2894293
                  |
     c.inc#c.hown |    9649.6129262-522788.5756313
                  |
    c.inc2#c.inc2 |   36363.2753790 -6.0481792e+14
                  |
    c.inc2#c.inc3 |   52281.7382215  9.4901336e+15
                  |
    c.inc2#c.inc4 |   52090.1655105 -1.9773509e+16
                  |
    c.inc2#c.inc5 |   35345.4137364 -8.0596607e+16
                  |
    c.inc2#c.inc6 |    9355.8476094  4.5549666e+17
                  |
    c.inc2#c.inc7 |  -19013.5665129 -7.6262760e+17
                  |
    c.inc2#c.inc8 |  -45741.6251511  4.3383084e+17
                  |
    c.inc2#c.educ |   10960.4520499  5.1526805e+09
                  |
   c.inc2#c.educ2 |    3593.4705821 -1.1378439e+10
                  |
   c.inc2#c.educ3 |   -6443.0650102  1.0112903e+10
                  |
   c.inc2#c.educ4 |  -17632.0369147 -3.0124092e+09
                  |
   c.inc2#c.fsize |    9763.7869407  8.2055245e+08
                  |
  c.inc2#c.fsize2 |    8805.4395376 -1.0569425e+09
                  |
    c.inc2#c.marr |    7824.9783411 -8.1365611e+07
                  |
 c.inc2#c.twoearn |  -46395.9927457  1.0020848e+08
                  |
      c.inc2#c.db |    4097.4071688  1.6348147e+07
                  |
    c.inc2#c.pira |   28468.6597829 -3.9019121e+07
                  |
    c.inc2#c.hown |   19722.86549268979377.0563293
                  |
    c.inc3#c.inc3 |   52090.1273490 -3.7180935e+16
                  |
    c.inc3#c.inc4 |   35345.3941219  2.4045394e+17
                  |
    c.inc3#c.inc5 |    9355.8472374 -2.7199859e+17
                  |
    c.inc3#c.inc6 |  -19013.5850173 -2.9190131e+17
                  |
    c.inc3#c.inc7 |  -45741.6253438  9.6288253e+17
                  |
    c.inc3#c.inc8 |  -69142.3942401 -6.2978971e+17
                  |
    c.inc3#c.educ |   20758.3267190 -8.1631359e+10
                  |
   c.inc3#c.educ2 |    4777.5834295  1.8229996e+11
                  |
   c.inc3#c.educ3 |  -19106.3036197 -1.6522942e+11
                  |
   c.inc3#c.educ4 |  -47516.4958922  5.1127774e+10
                  |
   c.inc3#c.fsize |   -2595.4500936 -1.1250323e+10
                  |
  c.inc3#c.fsize2 |  -39470.3916172  1.4774129e+10
                  |
    c.inc3#c.marr |   23108.1381301  1.0713756e+09
                  |
 c.inc3#c.twoearn | -120177.0261663 -1.2056006e+09
                  |
      c.inc3#c.db |    3075.5179364 -2.1557668e+08
                  |
    c.inc3#c.pira |   19439.0176345  3.1387139e+08
                  |
    c.inc3#c.hown |   28737.0683686 -7.4765506e+07
                  |
    c.inc4#c.inc4 |    9355.8616441 -3.9338658e+17
                  |
    c.inc4#c.inc5 |  -19013.5602845  1.1589433e+18
                  |
    c.inc4#c.inc6 |  -45741.6180609 -7.8008509e+17
                  |
    c.inc4#c.inc7 |  -69142.3789133  2.7132639e+17
                  |
    c.inc4#c.inc8 |  -88886.2178545 -1.2901502e+17
                  |
    c.inc4#c.educ |   48365.9225849  6.4590257e+11
                  |
   c.inc4#c.educ2 |   30800.0519552 -1.4579959e+12
                  |
   c.inc4#c.educ3 |   -5014.8257250  1.3422569e+12
                  |
   c.inc4#c.educ4 |  -54052.0602310 -4.2641349e+11
                  |
   c.inc4#c.fsize |   -4385.5249057  7.9252714e+10
                  |
  c.inc4#c.fsize2 | -177499.7898830 -1.0516414e+11
                  |
    c.inc4#c.marr |   48992.9922890 -7.3379946e+09
                  |
 c.inc4#c.twoearn | -223289.3656440  7.9436048e+09
                  |
      c.inc4#c.db |    5097.4802827  1.4348627e+09
                  |
    c.inc4#c.pira |   -5475.5490656 -1.2146855e+09
                  |
    c.inc4#c.hown |   43643.8450379  4.0254707e+08
                  |
    c.inc5#c.inc5 |  -45741.6112146 -6.1951629e+17
                  |
    c.inc5#c.inc6 |  -69142.3835050  3.6326772e+17
                  |
    c.inc5#c.inc7 |  -88886.2178937 -7.7135453e+17
                  |
    c.inc5#c.inc8 | -105285.4925749  1.0491576e+18
                  |
    c.inc5#c.educ |   82603.6253368 -2.7497910e+12
                  |
   c.inc5#c.educ2 |   80584.2135363  6.2671574e+12
                  |
   c.inc5#c.educ3 |   48295.5291464 -5.8404356e+12
                  |
   c.inc5#c.educ4 |  -12225.2888036  1.8900364e+12
                  |
   c.inc5#c.fsize |    9954.5851272 -3.0726131e+11
                  |
  c.inc5#c.fsize2 | -393194.8050715  4.0970585e+11
                  |
    c.inc5#c.marr |   67535.9763929  2.7909279e+10
                  |
 c.inc5#c.twoearn | -346834.6865182 -3.0036348e+10
                  |
      c.inc5#c.db |   10711.3476172 -5.2893582e+09
                  |
    c.inc5#c.pira |  -33107.2789984  1.9919561e+09
                  |
    c.inc5#c.hown |   55633.9795366 -1.5007457e+09
                  |
    c.inc6#c.inc6 |  -88886.2215643  8.9469030e+17
                  |
    c.inc6#c.inc7 | -105285.4920919 -1.0445477e+18
                  |
    c.inc6#c.inc8 | -118887.3914557 -6.4962631e+17
                  |
    c.inc6#c.educ |   98744.5954540  6.3896481e+12
                  |
   c.inc6#c.educ2 |  124672.6555537 -1.4677104e+13
                  |
   c.inc6#c.educ3 |  117402.5783300  1.3802310e+13
                  |
   c.inc6#c.educ4 |   66821.4885730 -4.5244966e+12
                  |
   c.inc6#c.fsize |    -757.3679976  6.6284360e+11
                  |
  c.inc6#c.fsize2 | -734336.2163849 -8.8478899e+11
                  |
    c.inc6#c.marr |   65337.1363985 -5.9387533e+10
                  |
 c.inc6#c.twoearn | -496236.6400762  6.4755330e+10
                  |
      c.inc6#c.db |     925.9226505  1.0948149e+10
                  |
    c.inc6#c.pira |  -57924.4016795  7.9255294e+07
                  |
    c.inc6#c.hown |   52733.6117722  3.6635598e+09
                  |
    c.inc7#c.inc7 | -118887.3923359  6.4721450e+17
                  |
    c.inc7#c.inc8 | -130271.6277037  7.1777765e+14
                  |
    c.inc7#c.educ |   86432.2949419 -7.6094278e+12
                  |
   c.inc7#c.educ2 |  135644.9601460  1.7575412e+13
                  |
   c.inc7#c.educ3 |  163782.9503767 -1.6631581e+13
                  |
   c.inc7#c.educ4 |  144998.3441922  5.4997575e+12
                  |
   c.inc7#c.fsize |  -66999.8032759 -7.4542185e+11
                  |
  c.inc7#c.fsize2 |  -1.2809042e+06  9.9308457e+11
                  |
    c.inc7#c.marr |   45106.4154426  6.6052568e+10
                  |
 c.inc7#c.twoearn | -690868.8415000 -7.3742155e+10
                  |
      c.inc7#c.db |  -56538.6439266 -1.1846017e+10
                  |
    c.inc7#c.pira |  -78961.1231549 -3.8546345e+09
                  |
    c.inc7#c.hown |   34801.6395463 -5.0241041e+09
                  |
    c.inc8#c.inc8 | -139962.9062496 -8.8970414e+13
                  |
    c.inc8#c.educ |   52247.7598327  3.6205330e+12
                  |
   c.inc8#c.educ2 |  107864.0809017 -8.3830370e+12
                  |
   c.inc8#c.educ3 |  162080.0442820  7.9601804e+12
                  |
   c.inc8#c.educ4 |  182105.9306625 -2.6462493e+12
                  |
   c.inc8#c.fsize | -181151.8147105  3.3998098e+11
                  |
  c.inc8#c.fsize2 |  -2.0377490e+06 -4.5070139e+11
                  |
    c.inc8#c.marr |   15949.2125354 -2.9809631e+10
                  |
 c.inc8#c.twoearn | -958934.3565511  3.4305493e+10
                  |
      c.inc8#c.db | -196280.3937857  5.1720101e+09
                  |
    c.inc8#c.pira |  -96286.6111085  3.0735405e+09
                  |
    c.inc8#c.hown |    8523.7312371  2.8422528e+09
                  |
    c.educ#c.educ |    -391.9049302  5.9085686e+11
                  |
   c.educ#c.educ2 |      67.5529893 -2.7291700e+12
                  |
   c.educ#c.educ3 |     163.9476048 -9.6281277e+12
                  |
   c.educ#c.educ4 |     147.2975101  4.5589725e+12
                  |
   c.educ#c.fsize |   -2652.88326041035692.5398662
                  |
  c.educ#c.fsize2 |   -1707.99116713085992.0342592
                  |
    c.educ#c.marr |    -654.5574873 -1.6395130e+06
                  |
 c.educ#c.twoearn |    -177.13921541696208.8257117
                  |
      c.educ#c.db |     134.0154220 -89425.6997333
                  |
    c.educ#c.pira |    1493.4952003 -1.2644243e+06
                  |
    c.educ#c.hown |      13.3679386-976355.5408486
                  |
  c.educ2#c.educ2 |     163.9478171  6.9390099e+12
                  |
  c.educ2#c.educ3 |     147.2976928 -4.5545121e+12
                  |
  c.educ2#c.educ4 |      87.9098408 -7.2617177e+12
                  |
  c.educ2#c.fsize |   -1818.3816190 -1.9362654e+06
                  |
 c.educ2#c.fsize2 |    -562.3165115 -9.0004557e+06
                  |
   c.educ2#c.marr |    -615.23036214484322.9633940
                  |
c.educ2#c.twoearn |    -705.6130661 -4.4620878e+06
                  |
     c.educ2#c.db |     -71.8775051 295121.8673774
                  |
   c.educ2#c.pira |    2053.21512912597510.3640251
                  |
   c.educ2#c.hown |     853.35916952485833.5477573
                  |
  c.educ3#c.educ3 |      87.9098525  7.2569769e+12
                  |
  c.educ3#c.educ4 |      10.9683364  2.7102374e+09
                  |
  c.educ3#c.fsize |    -340.2261304 920933.8014117
                  |
 c.educ3#c.fsize2 |    3322.2314804  1.0873768e+07
                  |
   c.educ3#c.marr |    -508.2972082 -5.0923063e+06
                  |
c.educ3#c.twoearn |   -1318.98936354966608.6566586
                  |
     c.educ3#c.db |    -285.1344647-387499.1969742
                  |
   c.educ3#c.pira |    2384.4045190 -2.1239156e+06
                  |
   c.educ3#c.hown |    1531.5103024 -2.6256038e+06
                  |
  c.educ4#c.educ4 |     -72.8379654 -6.4296390e+08
                  |
  c.educ4#c.fsize |    1009.7354959 -39787.3442204
                  |
 c.educ4#c.fsize2 |    8864.1743544 -4.2548482e+06
                  |
   c.educ4#c.marr |    -447.98900612053743.3564956
                  |
c.educ4#c.twoearn |   -1922.3006785 -1.9904199e+06
                  |
     c.educ4#c.db |    -452.4568205 167253.3687250
                  |
   c.educ4#c.pira |    2432.5782883 595411.3929852
                  |
   c.educ4#c.hown |    1936.8616772 995357.7287507
                  |
  c.fsize#c.fsize |     626.3832703  1.5194535e+11
                  |
 c.fsize#c.fsize2 |    2664.2815647 864077.7662514
                  |
   c.fsize#c.marr |    -262.6754241 -43228.1500446
                  |
c.fsize#c.twoearn |   -1027.9815126  30658.7955951
                  |
     c.fsize#c.db |    1671.3156651  30379.7995601
                  |
   c.fsize#c.pira |    -426.8599891-123448.5131117
                  |
   c.fsize#c.hown |    -488.8753053  29635.3994534
                  |
c.fsize2#c.fsize2 |    4627.2710140-411970.7424220
                  |
  c.fsize2#c.marr |     415.6223020  88421.7924259
                  |
         c.fsize2#|
        c.twoearn |   -3440.3489022 -45972.1149108
                  |
    c.fsize2#c.db |    2147.5039739 -25065.4062453
                  |
  c.fsize2#c.pira |  -13911.8710904 140276.0589121
                  |
  c.fsize2#c.hown |   -2576.4723836 -40514.6285037
                  |
    c.marr#c.marr |     121.5369438      (omitted)
                  |
 c.marr#c.twoearn |      30.5944647  -5993.2201081
                  |
      c.marr#c.db |    -344.8613973  -4361.8531376
                  |
    c.marr#c.pira |    2370.9894024   9997.7577804
                  |
    c.marr#c.hown |      98.8138801   -152.1097421
                  |
        c.twoearn#|
        c.twoearn |      52.5470449      (omitted)
                  |
   c.twoearn#c.db |     934.1436271   3347.6101126
                  |
 c.twoearn#c.pira |   -1304.1509126  -1090.3058290
                  |
 c.twoearn#c.hown |    -820.1643163  -5202.9325158
                  |
        c.db#c.db |     169.6441991      (omitted)
                  |
      c.db#c.pira |   -2140.7689361  -2477.1685895
                  |
      c.db#c.hown |    -355.2557289  -4275.3248903
                  |
    c.pira#c.pira |    1676.4920553      (omitted)
                  |
    c.pira#c.hown |    2696.6802279   1986.1343048
                  |
    c.hown#c.hown |     -53.7986515      (omitted)
------------------+--------------------------------
   Partialled-out*|
------------------+--------------------------------
                  |
            _cons |   -3822.4409901 -3.5701410e+10
---------------------------------------------------
No xb or residuals options specified. Assume xb (fitted values).
Use e(b) from previous lasso2 estimation (lambda=32521.8192486).

. 
. * Trick to get essentially OLS results for CV comparison        
. * Do lasso with a tiny penalty parameter
. cvlasso net_tfa /// 
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown)## ///
>         c.(e401 age age2 age3 age4 age5 age6 inc inc2 inc3 inc4 inc5 inc6 inc7 ///
>         inc8 educ educ2 educ3 educ4 fsize fsize2 marr twoearn db pira hown) ///
>         if trdata, lglmnet foldvar(fvar) lminratio(.0000000000001) lcount(2)
Use user-specified fold variable.

K-fold cross-validation with 5 folds. Elastic net with alpha=1.
Fold 1 2 3 4 5 
          |         Lambda           MSPE       st. dev.
----------+---------------------------------------------
         1|      32521.819      3.352e+09      6.327e+08  *^
         2|      3.252e-09      4.629e+09      1.992e+09  
* lopt = the lambda that minimizes MSPE.
  Run model: cvlasso, lopt
^ lse = largest lambda for which MSPE is within one standard error of the minimal MSPE.
  Run model: cvlasso, lse
Warning: lopt is at the limit of the lambda range.
Warning: lse is at the limit of the lambda range.

. 
. matrix mspe = e(mmspe)

. local mspeint = sqrt(mspe[2,1])

. display "Interactions - OLS CV " `mspeint'
Interactions - OLS CV 68037.181

.         
. 
. ****************************************************************************
. * Out of sample R^2
. gen r2_ols_base = (net_tfa - yhat_ols_base)^2

. gen r2_ols_poly = (net_tfa - yhat_ols_poly)^2

. gen r2_ols_int = (net_tfa - yhat_ols_int)^2

. 
. gen r2_lasso_base = (net_tfa - yhat_lasso_base)^2

. gen r2_lasso_poly = (net_tfa - yhat_lasso_poly)^2

. gen r2_lasso_int = (net_tfa - yhat_lasso_int)^2

. 
. gen r2_ridge_base = (net_tfa - yhat_ridge_base)^2

. gen r2_ridge_poly = (net_tfa - yhat_ridge_poly)^2

. gen r2_ridge_int = (net_tfa - yhat_ridge_int)^2

. 
. * Constant model
. qui reg net_tfa if trdata

. predict yhat_constant   
(option xb assumed; fitted values)

. gen r2_constant = (net_tfa - yhat_constant)^2

. 
. * Get R^2s
. qui sum r2_constant if !trdata

. local tssOut = r(mean)

. 
. qui sum r2_ols_base if !trdata

. local essOut_ols_base = r(mean)

. local r2Out_ols_base = 1-(`essOut_ols_base'/`tssOut')

. qui sum r2_ols_poly if !trdata

. local essOut_ols_poly = r(mean)

. local r2Out_ols_poly = 1-(`essOut_ols_poly'/`tssOut')

. qui sum r2_ols_int if !trdata

. local essOut_ols_int = r(mean)

. local r2Out_ols_int = 1-(`essOut_ols_int'/`tssOut')

. 
. display "OLS & " `r2Out_ols_base' " & " `r2Out_ols_poly' " & " `r2Out_ols_int' " \\"
OLS & .19463161 & .18139205 & .01252369 \\

. 
. qui sum r2_lasso_base if !trdata

. local essOut_lasso_base = r(mean)

. local r2Out_lasso_base = 1-(`essOut_lasso_base'/`tssOut')

. qui sum r2_lasso_poly if !trdata

. local essOut_lasso_poly = r(mean)

. local r2Out_lasso_poly = 1-(`essOut_lasso_poly'/`tssOut')

. qui sum r2_lasso_int if !trdata

. local essOut_lasso_int = r(mean)

. local r2Out_lasso_int = 1-(`essOut_lasso_int'/`tssOut')

. 
. display "Lasso & " `r2Out_lasso_base' " & " `r2Out_lasso_poly' " & " `r2Out_lasso_int' " \\"
Lasso & .19453121 & .19188643 & .1743967 \\

. 
. qui sum r2_ridge_base if !trdata

. local essOut_ridge_base = r(mean)

. local r2Out_ridge_base = 1-(`essOut_ridge_base'/`tssOut')

. qui sum r2_ridge_poly if !trdata

. local essOut_ridge_poly = r(mean)

. local r2Out_ridge_poly = 1-(`essOut_ridge_poly'/`tssOut')

. qui sum r2_ridge_int if !trdata

. local essOut_ridge_int = r(mean)

. local r2Out_ridge_int = 1-(`essOut_ridge_int'/`tssOut')

. 
. display "Ridge & " `r2Out_ridge_base' " & " `r2Out_ridge_poly' " & " `r2Out_ridge_int' " \\"
Ridge & .19453971 & .19161027 & .19087309 \\

. 
. *****************************************************************************
. log close
      name:  <unnamed>
       log:  C:\Users\chansen1\Documents\GitHub\NW2022_1Day\Stata Code\401kHDLMs.txt
  log type:  text
 closed on:  25 Jun 2024, 17:40:27
----------------------------------------------------------------------------------------------------------
